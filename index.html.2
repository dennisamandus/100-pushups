<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 armh√§vningar / dag</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#14161d;
      --text:#e8e8ea;
      --muted:#a8abb6;
      --border:#2a2d38;

      --green:#1f8a4c;
      --orange:#c77d1a;
      --red:#a13232;

      --btn:#1a1e2a;
      --btn2:#0f1118;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.35;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 22px;
      display: grid;
      gap: 12px;
    }

    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
    }

    h1{
      margin: 0 0 8px 0;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    h2{
      margin: 0 0 10px 0;
      font-size: 15px;
      font-weight: 800;
      letter-spacing: 0.2px;
      color: var(--text);
    }
    .muted{ color: var(--muted); font-size: 13px; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    input, button, textarea{
      font: inherit;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--btn2);
      color: var(--text);
      outline: none;
    }
    input{ width: 100%; }
    textarea{ width:100%; min-height: 120px; resize: vertical; }

    button{
      cursor: pointer;
      background: var(--btn);
      touch-action: manipulation;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    button.ghost{ background: transparent; }
    button.danger{ background: #2a1212; border-color:#4a1b1b; }
    button.good{ background: #102316; border-color:#234b33; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.1fr 1fr; }
      input{ width: 160px; }
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #0f1118;
      font-size: 13px;
      color: var(--muted);
    }
    .mono{
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:#3a3f52;
      display:inline-block;
    }
    .dot.green{ background: var(--green); }
    .dot.orange{ background: var(--orange); }
    .dot.red{ background: var(--red); }

    .big{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: 0.3px;
    }
    .bigsub{
      margin-top: 2px;
      color: var(--muted);
      font-size: 13px;
    }

    /* Quick buttons */
    .quick{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .quick button{
      padding: 14px 10px;
      font-weight: 800;
      border-radius: 14px;
    }
    @media (min-width: 860px){
      .quick{ grid-template-columns: repeat(5, minmax(0,1fr)); }
    }

    /* Log list */
    .loglist{
      margin-top: 12px;
      display:flex;
      flex-direction: column;
      gap:8px;
      max-height: 260px;
      overflow:auto;
      padding-right: 4px;
    }
    .logitem{
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      background: #0f1118;
      display:flex;
      justify-content: space-between;
      gap:10px;
      align-items:center;
    }

    /* Calendar */
    .cal-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .cal-title{
      font-weight:900;
      letter-spacing:0.2px;
      font-size: 14px;
    }
    .cal{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    .dow{
      font-size: 11px;
      color: var(--muted);
      text-align:center;
      padding: 6px 0;
    }
    .day{
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #0f1118;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 8px;
      cursor:pointer;
      user-select:none;
    }
    .day:hover{ filter: brightness(1.08); }
    .day.off{
      opacity: 0.35;
      cursor: default;
    }
    .daynum{
      font-weight:900;
      font-size: 13px;
      color: var(--text);
    }
    .dayval{
      font-size: 12px;
      color: var(--muted);
      text-align:right;
    }
    .day.red{ border-color: rgba(161,50,50,0.65); }
    .day.orange{ border-color: rgba(199,125,26,0.75); }
    .day.green{ border-color: rgba(31,138,76,0.75); }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .section-divider{
      height:1px;
      background: var(--border);
      margin: 12px 0;
    }

    .two{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 860px){
      .two{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Armh√§vningar ‚Äì dagligt m√•l</h1>
      <div class="muted">Sparas lokalt i din webbl√§sare (localStorage). Export/Import finns om du vill flytta datan.</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Idag</h2>

        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <div class="big mono" id="todayTotal">0</div>
            <div class="bigsub">Gjort idag</div>
          </div>

          <div style="text-align:right;">
            <div class="pill"><span id="statusDot" class="dot"></span><span id="statusText">‚Äî</span></div>
            <div style="height:8px;"></div>
            <div class="pill">M√•l: <span class="mono" id="goalText">100</span></div>
            <div style="height:8px;"></div>
            <div class="pill">Kvar: <span class="mono" id="todayLeft">100</span></div>
          </div>
        </div>

        <div class="quick" aria-label="Snabbknappar">
          <button data-add="5">+5</button>
          <button data-add="10">+10</button>
          <button data-add="15">+15</button>
          <button data-add="20">+20</button>
          <button data-add="25">+25</button>
        </div>

        <div class="row" style="margin-top: 12px;">
          <input id="addInput" type="number" inputmode="numeric" min="1" placeholder="Eget antal (t.ex. 12)" />
          <button id="addBtn" class="good" style="width:100%;">L√§gg till</button>
        </div>

        <div class="two" style="margin-top:10px;">
          <div class="row" style="gap:10px;">
            <input id="goalInput" type="number" inputmode="numeric" min="1" placeholder="√Ñndra m√•l (t.ex. 100)" />
            <button id="setGoalBtn" class="ghost" style="width:100%;">S√§tt m√•l</button>
          </div>
          <div class="row" style="gap:10px;">
            <button id="undoBtn" class="ghost" style="width:100%;">√Öngra senaste</button>
            <button id="resetTodayBtn" class="danger" style="width:100%;">Nollst√§ll idag</button>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="row">
          <span class="pill">Streak (gr√∂n i rad): <span class="mono" id="streak">0</span></span>
          <span class="pill">30 dagar: <span class="mono" id="statsText">‚Äî</span></span>
        </div>

        <div class="loglist" id="logList"></div>
      </div>

      <div class="card">
        <div class="cal-head">
          <div class="cal-title" id="calTitle">‚Äî</div>
          <div class="row" style="gap:8px;">
            <button id="prevMonthBtn" class="ghost" aria-label="F√∂reg√•ende m√•nad">‚óÄ</button>
            <button id="todayBtn" class="ghost">Idag</button>
            <button id="nextMonthBtn" class="ghost" aria-label="N√§sta m√•nad">‚ñ∂</button>
          </div>
        </div>

        <div class="cal" id="calGrid"></div>

        <div class="legend">
          <span class="pill"><span class="dot green"></span>Gr√∂n = klarat</span>
          <span class="pill"><span class="dot orange"></span>Orange = p√•b√∂rjat</span>
          <span class="pill"><span class="dot red"></span>R√∂d = inte b√∂rjat</span>
        </div>

        <div class="section-divider"></div>

        <h2>Export / Import</h2>
        <div class="muted" style="margin-bottom:10px;">
          F√∂r att flytta data mellan mobil & dator: Exportera (kopiera texten) och importera p√• den andra enheten.
        </div>
        <div class="row" style="gap:10px;">
          <button id="exportBtn" class="ghost" style="width:100%;">Exportera</button>
          <button id="importBtn" class="good" style="width:100%;">Importera</button>
        </div>
        <div style="height:10px;"></div>
        <textarea id="dataBox" placeholder="H√§r hamnar export. Klistra ocks√• in h√§r f√∂r import."></textarea>
        <div class="muted" style="margin-top:8px;">
          Import ers√§tter din nuvarande data (men du kan exportera f√∂rst som backup).
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => {
      const y = d.getFullYear();
      const m = pad2(d.getMonth() + 1);
      const day = pad2(d.getDate());
      return `${y}-${m}-${day}`;
    };
    const monthNameSV = (m) => [
      "Januari","Februari","Mars","April","Maj","Juni",
      "Juli","Augusti","September","Oktober","November","December"
    ][m];

    function isoToDate(iso){
      // Safe local date from YYYY-MM-DD
      const [y,m,d] = iso.split("-").map(Number);
      return new Date(y, m - 1, d);
    }

    // ---------- Storage ----------
    const STORAGE_KEY = "pushups_simple_v2";

    function defaultState(){
      return { goal: 100, days: {} };
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return defaultState();
        if(typeof parsed.goal !== "number" || parsed.goal <= 0) parsed.goal = 100;
        if(!parsed.days || typeof parsed.days !== "object") parsed.days = {};
        // normalize day objects
        for(const k of Object.keys(parsed.days)){
          const day = parsed.days[k];
          if(!day || typeof day !== "object") { delete parsed.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return parsed;
      }catch{
        return defaultState();
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function ensureDay(iso){
      if(!state.days[iso]){
        state.days[iso] = { total: 0, entries: [] };
      }
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    // ---------- App State ----------
    let state = loadState();
    let currentMonth = new Date();
    currentMonth.setDate(1);

    // ---------- DOM ----------
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const goalText = document.getElementById("goalText");
    const todayTotalEl = document.getElementById("todayTotal");
    const todayLeftEl = document.getElementById("todayLeft");

    const addInput = document.getElementById("addInput");
    const addBtn = document.getElementById("addBtn");
    const goalInput = document.getElementById("goalInput");
    const setGoalBtn = document.getElementById("setGoalBtn");
    const undoBtn = document.getElementById("undoBtn");
    const resetTodayBtn = document.getElementById("resetTodayBtn");

    const streakEl = document.getElementById("streak");
    const statsTextEl = document.getElementById("statsText");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    const logList = document.getElementById("logList");

    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const dataBox = document.getElementById("dataBox");

    // ---------- Core logic ----------
    function getDayTotal(iso){
      return state.days[iso]?.total ?? 0;
    }

    function getDayStatusByTotal(total){
      if(total >= state.goal) return "green";
      if(total > 0) return "orange";
      return "red";
    }

    function calcStreak(){
      // streak of "green" days ending at today
      let streak = 0;
      let d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        if(total >= state.goal){
          streak += 1;
          d.setDate(d.getDate() - 1);
        }else{
          break;
        }
      }
      return streak;
    }

    function calc30DayStats(){
      const today = new Date();
      let green=0, orange=0, red=0, sum=0;

      for(let i=0;i<30;i++){
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        sum += total;

        const st = getDayStatusByTotal(total);
        if(st === "green") green++;
        else if(st === "orange") orange++;
        else red++;
      }
      return { green, orange, red, sum };
    }

    function renderToday(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const total = day.total;

      goalText.textContent = state.goal;
      todayTotalEl.textContent = total;

      const left = Math.max(0, state.goal - total);
      todayLeftEl.textContent = left;

      const st = getDayStatusByTotal(total);
      statusDot.className = "dot " + st;
      statusText.textContent =
        st === "green" ? "Klar ‚úÖ" :
        st === "orange" ? "P√•b√∂rjad" :
        "Inte b√∂rjad";

      // streak + stats
      streakEl.textContent = calcStreak();
      const s = calc30DayStats();
      statsTextEl.textContent = `üü© ${s.green}  üüß ${s.orange}  üü• ${s.red}  ‚Ä¢  Totalt: ${s.sum}`;

      // logglista (idag)
      logList.innerHTML = "";
      const entries = day.entries.slice().sort((a,b) => b.ts - a.ts);
      if(entries.length === 0){
        const empty = document.createElement("div");
        empty.className = "muted";
        empty.textContent = "Inga inl√§gg idag √§nnu.";
        logList.appendChild(empty);
      }else{
        for(const e of entries){
          const item = document.createElement("div");
          item.className = "logitem";
          const t = new Date(e.ts);
          const hh = pad2(t.getHours());
          const mm = pad2(t.getMinutes());
          item.innerHTML = `
            <div>
              <div class="mono">${e.n} st</div>
              <div class="muted">${hh}:${mm}</div>
            </div>
            <div class="muted">+${e.n}</div>
          `;
          logList.appendChild(item);
        }
      }
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthNameSV(m)} ${y}`;

      calGrid.innerHTML = "";

      // Dagar i veckan header (M√•n f√∂rst)
      const dows = ["M√•n","Tis","Ons","Tor","Fre","L√∂r","S√∂n"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7;
      const daysInMonth = new Date(y, m + 1, 0).getDate();

      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"> </div><div class="dayval"> </div>`;
        calGrid.appendChild(ghost);
      }

      for(let dayNum = 1; dayNum <= daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatusByTotal(total);

        const cell = document.createElement("div");
        cell.className = `day ${st}`;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval mono">${total}</div>
        `;

        // Click: show info and offer reset day
        cell.addEventListener("click", () => {
          const msg =
            `${iso}\n` +
            `Totalt: ${total}\n` +
            `M√•l: ${state.goal}\n\n` +
            `OK = nollst√§ll den h√§r dagen\n` +
            `Avbryt = l√§mna som det √§r`;
          const ok = confirm(msg);
          if(ok){
            delete state.days[iso];
            saveState();
            renderAll();
          }
        });

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderToday();
      renderCalendar();
    }

    // ---------- Actions ----------
    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      day.total += n;
      day.entries.push({ ts: Date.now(), n: Math.floor(n) });
      saveState();
      renderAll();
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;
      const last = day.entries.pop();
      day.total = Math.max(0, day.total - (last?.n ?? 0));
      if(day.total === 0 && day.entries.length === 0){
        delete state.days[iso];
      }
      saveState();
      renderAll();
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      delete state.days[iso];
      saveState();
      renderAll();
    }

    function setGoal(n){
      if(!Number.isFinite(n) || n <= 0) return;
      state.goal = Math.floor(n);
      saveState();
      renderAll();
    }

    function doExport(){
      // include version for future safety
      const payload = {
        version: 2,
        exportedAt: new Date().toISOString(),
        data: state
      };
      dataBox.value = JSON.stringify(payload, null, 2);
      dataBox.focus();
      dataBox.select();
    }

    function doImport(){
      try{
        const raw = dataBox.value.trim();
        if(!raw) return alert("Klistra in export-data f√∂rst.");
        const parsed = JSON.parse(raw);

        // accept either full payload or direct state
        const incoming = parsed?.data ?? parsed;

        if(!incoming || typeof incoming !== "object") throw new Error("Fel format");
        if(typeof incoming.goal !== "number" || incoming.goal <= 0) throw new Error("Saknar goal");
        if(!incoming.days || typeof incoming.days !== "object") throw new Error("Saknar days");

        // Normalize incoming
        const cleaned = { goal: Math.floor(incoming.goal), days: {} };
        for(const iso of Object.keys(incoming.days)){
          const day = incoming.days[iso];
          if(!day || typeof day !== "object") continue;
          const total = Number(day.total ?? 0);
          const entries = Array.isArray(day.entries) ? day.entries : [];
          cleaned.days[iso] = {
            total: Number.isFinite(total) ? total : 0,
            entries: entries
              .filter(e => e && typeof e === "object")
              .map(e => ({ ts: Number(e.ts ?? Date.now()), n: Number(e.n ?? 0) }))
              .filter(e => Number.isFinite(e.ts) && Number.isFinite(e.n) && e.n > 0)
          };
        }

        const ok = confirm("Import ers√§tter din nuvarande data. Vill du forts√§tta?");
        if(!ok) return;

        state = cleaned;
        saveState();
        renderAll();
        alert("Import klar ‚úÖ");
      }catch(e){
        alert("Kunde inte importera. Kontrollera att du klistrat in r√§tt data.");
      }
    }

    // ---------- Wire up ----------
    document.querySelectorAll("button[data-add]").forEach(btn => {
      btn.addEventListener("click", () => addReps(Number(btn.dataset.add)));
    });

    addBtn.addEventListener("click", () => {
      const n = Number(addInput.value);
      addInput.value = "";
      addInput.focus();
      addReps(n);
    });
    addInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") addBtn.click();
    });

    setGoalBtn.addEventListener("click", () => {
      const n = Number(goalInput.value);
      goalInput.value = "";
      setGoal(n);
    });

    undoBtn.addEventListener("click", undoLast);

    resetTodayBtn.addEventListener("click", () => {
      const ok = confirm("Nollst√§lla dagens logg?");
      if(ok) resetToday();
    });

    prevMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      currentMonth = new Date();
      currentMonth.setDate(1);
      renderAll();
    });

    exportBtn.addEventListener("click", doExport);
    importBtn.addEventListener("click", doImport);

    // ---------- Init ----------
    renderAll();
  </script>
</body>
</html>
