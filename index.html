<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 Pushups</title>

  <!-- Fonts (optional but nice) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0c;
      --panel:#121214;
      --panel2:#0f0f11;
      --cream:#f4f1e9;
      --muted:rgba(244,241,233,.70);
      --muted2:rgba(244,241,233,.55);
      --border:rgba(244,241,233,.10);

      --accent:#e33b2f;     /* warm red */
      --accent2:#ff7a2f;    /* orange */
      --good:#2fd07f;       /* subtle green for success */
      --shadow: rgba(0,0,0,.45);

      --radius:18px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% -10%, rgba(227,59,47,.14), transparent 55%),
                  radial-gradient(900px 600px at 80% 0%, rgba(255,122,47,.08), transparent 60%),
                  var(--bg);
      color:var(--cream);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== Loading screen ===== */
    .loading{
      position: fixed; inset: 0;
      background: var(--bg);
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
      transition: opacity 420ms ease, visibility 420ms ease;
    }
    .loading.hidden{ opacity:0; visibility:hidden; }
    .loadingCard{
      width: min(560px, calc(100vw - 32px));
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(244,241,233,0.07), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.04), transparent),
        var(--panel);
      padding: 18px;
      text-align:center;
      overflow:hidden;
      position: relative;
      box-shadow: 0 18px 50px var(--shadow);
    }
    .loadingTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      font-size: 16px;
      line-height: 1.2;
      color: rgba(244,241,233,.95);
    }
    .loadingCount{
      margin-top: 14px;
      font-variant-numeric: tabular-nums;
      font-family: "Space Grotesk", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 54px;
      font-weight: 700;
      letter-spacing: 0.6px;
      opacity: .95;
    }
    .dots{ margin-top: 12px; display:flex; justify-content:center; gap: 8px; }
    .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(244,241,233,0.20);
      animation: pulse 900ms ease-in-out infinite;
    }
    .dot:nth-child(2){ animation-delay: 120ms; }
    .dot:nth-child(3){ animation-delay: 240ms; }
    @keyframes pulse{
      0%,100%{ transform: translateY(0); opacity: 0.35; }
      50%{ transform: translateY(-4px); opacity: 0.95; }
    }
    .shine{
      position:absolute; inset: -40% -60%;
      background: linear-gradient(90deg, transparent, rgba(244,241,233,0.10), transparent);
      transform: rotate(12deg);
      animation: sweep 1400ms ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{
      0%{ transform: translateX(-20%) rotate(12deg); opacity: 0; }
      20%{ opacity: 1; }
      100%{ transform: translateX(20%) rotate(12deg); opacity: 0; }
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 14px 110px; /* room for sticky CTA */
      display:grid;
      gap: 12px;
    }

    .topHero{
      text-align:center;
      padding: 6px 2px 2px;
    }
    .heroTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.6px;
      text-transform: uppercase;
      font-size: 16px;
      line-height: 1.15;
      color: rgba(244,241,233,.95);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.05fr 1fr; align-items:start; }
      .wrap{ padding-bottom: 24px; }
      .stickyCta{ position: sticky; bottom: 16px; }
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background:
        radial-gradient(1200px 600px at 50% 0%, rgba(244,241,233,0.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.03), transparent),
        var(--panel);
      padding: 14px;
      box-shadow: 0 16px 40px var(--shadow);
    }

    /* ===== Main card (left) ===== */
    .todayLine{
      display:flex;
      align-items:flex-end;
      justify-content:center;
      gap: 10px;
      flex-wrap:wrap;
      padding-top: 8px;
    }
    .todayBig{
      font-family: "Space Grotesk", Inter, system-ui;
      font-size: clamp(40px, 9vw, 64px);
      font-weight: 700;
      letter-spacing: 0.2px;
      line-height: 1;
    }
    .todaySmall{
      font-family: "Space Grotesk", Inter, system-ui;
      font-size: clamp(18px, 4vw, 22px);
      font-weight: 700;
      color: rgba(244,241,233,.80);
      padding-bottom: 6px;
    }

    .statsRow{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      gap: 10px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
      user-select:none;
    }
    .pill strong{
      color: rgba(244,241,233,.92);
      font-weight: 800;
    }

    .progressWrap{
      margin-top: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding: 12px;
    }
    .progressTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    .bar{
      margin-top: 10px;
      height: 12px;
      border-radius: 999px;
      background: rgba(244,241,233,0.08);
      border: 1px solid var(--border);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 250ms ease;
    }

    .levelRow{
      margin-top: 10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 13px;
    }
    .levelRow strong{ color: rgba(244,241,233,.95); font-weight: 800; }

    .miniActions{
      margin-top: 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }
    .linkBtn{
      background: transparent;
      border: none;
      color: rgba(244,241,233,.75);
      font-weight: 700;
      padding: 8px 0;
      cursor:pointer;
      text-decoration: underline;
      text-underline-offset: 4px;
    }
    .linkBtn:hover{ color: rgba(244,241,233,.95); }

    .menuBtn{
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      color: rgba(244,241,233,.9);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing: 0.3px;
    }

    /* ===== Right card: Copy + Calendar + Avatar ===== */
    .stateTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.1px;
      text-transform: uppercase;
      font-size: 13px;
      color: rgba(244,241,233,.85);
      text-align:center;
      margin-top: 6px;
    }
    .stateCopy{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }

    .calHead{
      margin-top: 14px;
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
    }
    .calTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      font-size: 15px;
      letter-spacing: 0.2px;
    }
    .calBtns{ display:flex; gap:8px; }
    .btnGhost{
      background: transparent;
      border: 1px solid var(--border);
      color: rgba(244,241,233,.9);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 800;
    }
    .btnGhost:hover{ filter: brightness(1.08); }

    .cal{
      margin-top: 8px;
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
    }
    .dow{
      font-size: 11px;
      color: var(--muted2);
      text-align:center;
      padding: 4px 0 6px;
      text-transform: uppercase;
      letter-spacing: .3px;
    }

    .day{
      height: clamp(44px, 9.8vw, 62px);
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.20);
      padding: 7px 7px 6px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      min-width:0;
      position: relative;
    }
    .day.off{ opacity:0.25; cursor:default; }

    .daynum{ font-weight:900; font-size: 13px; line-height:1; }
    .dayval{
      font-size: 12px;
      color: rgba(244,241,233,.70);
      text-align:right;
      line-height:1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }

    /* States */
    .day.before{ opacity:.35; }
    .day.missed{ opacity:.55; }
    .day.started{
      opacity: 1;
      border-color: rgba(255,122,47,.35);
      background: rgba(255,122,47,.08);
    }
    .day.done{
      opacity: 1;
      border-color: rgba(227,59,47,.55);
      background: rgba(227,59,47,.22);
    }
    .day.today{
      box-shadow: 0 0 0 2px rgba(227,59,47,.40) inset, 0 0 28px rgba(227,59,47,.18);
    }

    /* Streak visual: subtle glow strip at bottom */
    .day.streak::after{
      content:"";
      position:absolute;
      left:10px; right:10px; bottom:8px;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,122,47,.0), rgba(255,122,47,.7), rgba(227,59,47,.8));
      opacity: .75;
      pointer-events:none;
    }

    /* Avatar / level block */
    .avatarBlock{
      margin-top: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      padding: 14px;
      position: relative;
      overflow: hidden;
    }
    .avatarTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--muted);
      text-align:center;
    }
    .avatarWrap{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 12px;
    }
    .avatarImg{
      width: 170px;
      height: auto;
      filter: drop-shadow(0 0 calc(22px * var(--pGlow,0.08)) rgba(227,59,47,var(--pGlow,0.14)));
    }
    .avatarMeta{
      margin-top: 8px;
      text-align:center;
      font-weight: 900;
      letter-spacing: .4px;
      color: rgba(244,241,233,.92);
    }
    .avatarHint{
      margin-top: 6px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
    }

    /* ===== Sticky CTA ===== */
    .stickyCta{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      padding: 12px 14px calc(12px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(11,11,12,0), rgba(11,11,12,.85) 20%, rgba(11,11,12,.95));
      z-index: 50;
    }
    .ctaRow{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .ctaBtn{
      flex: 1;
      border: 1px solid rgba(244,241,233,.12);
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: rgba(244,241,233,.95);
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      border-radius: 16px;
      padding: 16px 14px;
      cursor:pointer;
      box-shadow: 0 16px 40px rgba(227,59,47,.20);
    }
    .ctaBtn:active{ transform: translateY(1px); }
    .ctaSide{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: rgba(244,241,233,.90);
      border-radius: 16px;
      padding: 16px 14px;
      font-weight: 900;
      cursor:pointer;
      min-width: 54px;
    }

    /* ===== Bottom sheet (log + day details) ===== */
    .sheetOverlay{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      z-index: 80;
    }
    .sheetOverlay.show{ display:block; }

    .sheet{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(244,241,233,0.06), transparent 60%),
        var(--panel);
      border-top-left-radius: 22px;
      border-top-right-radius: 22px;
      border: 1px solid var(--border);
      border-bottom: none;
      transform: translateY(105%);
      transition: transform 220ms ease;
      z-index: 90;
      box-shadow: 0 -18px 60px rgba(0,0,0,.55);
      padding-bottom: calc(14px + env(safe-area-inset-bottom));
    }
    .sheet.show{ transform: translateY(0); }

    .sheetHandle{
      width: 44px; height: 5px;
      border-radius: 999px;
      background: rgba(244,241,233,.18);
      margin: 10px auto 6px;
    }
    .sheetHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 6px 14px 10px;
    }
    .sheetTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 14px;
    }
    .sheetClose{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: rgba(244,241,233,.90);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
    }

    .sheetBody{ padding: 0 14px 14px; }

    /* Log sheet UI */
    .amountDisplay{
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 12px;
    }
    .amountValue{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      font-size: 40px;
      letter-spacing: 0.4px;
      text-align:center;
    }
    .amountSub{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }

    .chips{
      margin-top: 10px;
      display:flex;
      gap: 8px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: rgba(244,241,233,.92);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
      min-width: 54px;
      text-align:center;
    }

    .numpad{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .key{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: rgba(244,241,233,.95);
      border-radius: 16px;
      padding: 16px 10px;
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      font-size: 22px;
      cursor:pointer;
      user-select:none;
    }
    .key:active{ transform: translateY(1px); }
    .key.dim{ color: rgba(244,241,233,.70); }

    .okRow{
      margin-top: 12px;
      display:flex;
      gap: 10px;
    }
    .okBtn{
      flex: 1;
      border: 1px solid rgba(244,241,233,.12);
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: rgba(244,241,233,.95);
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      border-radius: 16px;
      padding: 14px 14px;
      cursor:pointer;
    }
    .okBtn:disabled{
      opacity:.45;
      cursor:not-allowed;
      filter:saturate(.5);
    }

    /* Day detail list */
    .detailBox{
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 12px;
    }
    .detailTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .2px;
    }
    .detailTop strong{ color: rgba(244,241,233,.95); font-weight: 900; }
    .logs{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      max-height: 260px;
      overflow:auto;
      padding-right: 4px;
    }
    .logRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      padding: 10px 12px;
      border-radius: 14px;
      color: rgba(244,241,233,.90);
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 12px;
    }
    .dangerHold{
      margin-top: 12px;
      border: 1px solid rgba(227,59,47,.28);
      background: rgba(227,59,47,.08);
      color: rgba(244,241,233,.95);
      border-radius: 16px;
      padding: 14px 14px;
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      cursor:pointer;
      width: 100%;
    }
    .dangerHold.holding{
      background: rgba(227,59,47,.22);
      border-color: rgba(227,59,47,.55);
    }

    /* Confetti (simple, lightweight) */
    .confetti{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 120;
      overflow:hidden;
      display:none;
    }
    .confetti.show{ display:block; }
    .confetti i{
      position:absolute;
      top:-10px;
      width: 10px;
      height: 14px;
      border-radius: 2px;
      opacity:.9;
      animation: fall 900ms ease-out forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    /* Micro pop for TODAY number */
    .pop{
      animation: pop 220ms ease-out;
    }
    @keyframes pop{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.04); }
      100%{ transform: scale(1); }
    }
  </style>
</head>

<body>
  <!-- Loading -->
  <div class="loading" id="loading">
    <div class="loadingCard">
      <div class="shine"></div>
      <div class="loadingTitle">100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY</div>
      <div class="loadingCount" id="loadingCount">0</div>
      <div class="dots" aria-label="Loading">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <div class="wrap">
    <div class="topHero">
      <div class="heroTitle">100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY</div>
    </div>

    <div class="grid">
      <!-- LEFT: Main -->
      <div class="card">
        <div class="todayLine">
          <div class="todayBig" id="todayText">TODAY: 0 / 100</div>
        </div>

        <div class="statsRow">
          <div class="pill">STREAK: <strong id="streakText">0</strong> days</div>
          <div class="pill">REMAINING: <strong id="remainingText">100</strong></div>
        </div>

        <div class="progressWrap">
          <div class="progressTop">
            <div><span id="pctText">0%</span> complete</div>
            <div>Remaining: <span id="remainingText2">100</span></div>
          </div>
          <div class="bar"><div id="barFill"></div></div>

          <div class="levelRow">
            <div><strong id="levelText">Level 1</strong></div>
            <div>Next level in <strong id="nextLevelText">100</strong> pushups</div>
          </div>
        </div>

        <div class="miniActions">
          <button class="linkBtn" id="undoBtn">Undo last</button>
          <button class="menuBtn" id="menuBtn">⋯</button>
        </div>

        <div id="menuPanel" style="display:none;margin-top:10px;">
          <button class="dangerHold" id="resetHoldBtn">Hold to reset today</button>
        </div>
      </div>

      <!-- RIGHT: State + Calendar + Avatar -->
      <div class="card">
        <div class="stateTitle" id="stateTitle">KEEP GOING</div>
        <div class="stateCopy" id="stateCopy">You can do it. Start with 10.</div>

        <div class="calHead">
          <div class="calTitle" id="calTitle">—</div>
          <div class="calBtns">
            <button class="btnGhost" id="prevMonthBtn">◀</button>
            <button class="btnGhost" id="todayBtn">Today</button>
            <button class="btnGhost" id="nextMonthBtn">▶</button>
          </div>
        </div>

        <div class="cal" id="calGrid"></div>

        <div class="avatarBlock" id="avatarBlock">
          <div class="avatarTitle">STREAK AVATAR</div>
          <div class="avatarWrap">
            <img id="avatarImg" class="avatarImg" src="avatar_0.png" alt="Streak avatar">
          </div>
          <div class="avatarMeta" id="avatarMeta">LEVEL 0</div>
          <div class="avatarHint" id="avatarHint">Start the streak.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sticky CTA -->
  <div class="stickyCta">
    <div class="ctaRow">
      <button class="ctaBtn" id="logBtn">LOG PUSHUPS</button>
      <button class="ctaSide" id="openLogBtn" aria-label="Open log">＋</button>
    </div>
  </div>

  <!-- Overlay + Sheet (re-used for log and day details) -->
  <div class="sheetOverlay" id="sheetOverlay"></div>
  <div class="sheet" id="sheet">
    <div class="sheetHandle"></div>
    <div class="sheetHead">
      <div class="sheetTitle" id="sheetTitle">LOG PUSHUPS</div>
      <button class="sheetClose" id="sheetClose">Close</button>
    </div>
    <div class="sheetBody" id="sheetBody">
      <!-- Dynamic content -->
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const GOAL = 100;
    const STORAGE_KEY = "pushups_simple_v2";

    // Avatar files are in repo ROOT (same folder as index.html)
    const AVATARS = [
      "avatar_0.png",
      "avatar_1.png",
      "avatar_2.png",
      "avatar_3.png",
      "avatar_4.png",
      "avatar_5.png"
    ];

    // Streak -> level (0..5)
    function levelFromStreak(streak){
      if(streak <= 0) return 0;
      if(streak <= 2) return 1;
      if(streak <= 6) return 2;
      if(streak <= 13) return 3;
      if(streak <= 20) return 4;
      return 5;
    }

    const avatarHints = [
      "Start the streak.",
      "Nice! Keep it going.",
      "Solid momentum.",
      "Strong streak. Don’t break it.",
      "Beast mode.",
      "MAX POWER. Legendary."
    ];

    // Level system (lifetime total)
    // Simple: each 100 lifetime pushups = +1 level
    function calcLevelFromLifetime(lifetime){
      const lvl = Math.floor(lifetime / 100) + 1; // starts at level 1
      const nextAt = lvl * 100;
      const remaining = Math.max(0, nextAt - lifetime);
      return { lvl, nextIn: remaining };
    }

    // ===== HELPERS =====
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    const monthName = (m) => ["January","February","March","April","May","June","July","August","September","October","November","December"][m];
    const fmtTime = (ts) => {
      const d = new Date(ts);
      return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    };

    function defaultState(){
      return {
        days: {},              // { "YYYY-MM-DD": { total: number, entries: [{ts,n}] } }
        lastAmount: "10",      // prefill numpad
        lifetime: 0            // lifetime logged reps
      };
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const s = JSON.parse(raw);
        if(!s || typeof s !== "object") return defaultState();
        if(!s.days || typeof s.days !== "object") s.days = {};
        if(typeof s.lastAmount !== "string") s.lastAmount = "10";
        if(typeof s.lifetime !== "number") s.lifetime = 0;

        for(const k of Object.keys(s.days)){
          const day = s.days[k];
          if(!day || typeof day !== "object") { delete s.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return s;
      }catch{
        return defaultState();
      }
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function ensureDay(iso){
      if(!state.days[iso]) state.days[iso] = { total: 0, entries: [] };
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    function getDay(iso){ return state.days[iso] || null; }
    function getDayTotal(iso){ return state.days[iso]?.total ?? 0; }

    function calcStreak(){
      let s = 0;
      const d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        if(getDayTotal(iso) >= GOAL){
          s++;
          d.setDate(d.getDate()-1);
        }else break;
      }
      return s;
    }

    function triggerPop(el){
      el.classList.remove("pop");
      void el.offsetWidth;
      el.classList.add("pop");
    }

    // Confetti
    function burstConfetti(){
      const c = document.getElementById("confetti");
      c.innerHTML = "";
      c.classList.add("show");

      const count = 24;
      for(let i=0;i<count;i++){
        const piece = document.createElement("i");
        // Random-ish colors (accent palette)
        const colors = ["#e33b2f","#ff7a2f","#f4f1e9","#2fd07f"];
        piece.style.background = colors[Math.floor(Math.random()*colors.length)];
        piece.style.left = Math.round(Math.random()*100) + "vw";
        piece.style.transform = `translateY(0) rotate(${Math.round(Math.random()*180)}deg)`;
        piece.style.animationDelay = (Math.random()*0.08) + "s";
        piece.style.opacity = (0.6 + Math.random()*0.4).toFixed(2);
        c.appendChild(piece);
      }

      setTimeout(()=> c.classList.remove("show"), 950);
    }

    // ===== DOM =====
    const loading = document.getElementById("loading");
    const loadingCount = document.getElementById("loadingCount");

    const todayText = document.getElementById("todayText");
    const streakText = document.getElementById("streakText");
    const remainingText = document.getElementById("remainingText");
    const remainingText2 = document.getElementById("remainingText2");
    const pctText = document.getElementById("pctText");
    const barFill = document.getElementById("barFill");

    const levelText = document.getElementById("levelText");
    const nextLevelText = document.getElementById("nextLevelText");

    const stateTitle = document.getElementById("stateTitle");
    const stateCopy = document.getElementById("stateCopy");

    const undoBtn = document.getElementById("undoBtn");
    const menuBtn = document.getElementById("menuBtn");
    const menuPanel = document.getElementById("menuPanel");
    const resetHoldBtn = document.getElementById("resetHoldBtn");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    const avatarBlock = document.getElementById("avatarBlock");
    const avatarImg = document.getElementById("avatarImg");
    const avatarMeta = document.getElementById("avatarMeta");
    const avatarHint = document.getElementById("avatarHint");

    const logBtn = document.getElementById("logBtn");
    const openLogBtn = document.getElementById("openLogBtn");

    const sheetOverlay = document.getElementById("sheetOverlay");
    const sheet = document.getElementById("sheet");
    const sheetTitle = document.getElementById("sheetTitle");
    const sheetClose = document.getElementById("sheetClose");
    const sheetBody = document.getElementById("sheetBody");

    // ===== STATE =====
    let state = loadState();
    let currentMonth = new Date(); currentMonth.setDate(1);

    // ===== SHEET (modal) =====
    function openSheet(title, html){
      sheetTitle.textContent = title;
      sheetBody.innerHTML = html;
      sheetOverlay.classList.add("show");
      sheet.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function closeSheet(){
      sheetOverlay.classList.remove("show");
      sheet.classList.remove("show");
      document.body.style.overflow = "";
      // Cleanup content after animation
      setTimeout(()=> { if(!sheet.classList.contains("show")) sheetBody.innerHTML = ""; }, 260);
    }
    sheetOverlay.addEventListener("click", closeSheet);
    sheetClose.addEventListener("click", closeSheet);

    // ===== LOG FLOW =====
    function openLogSheet(){
      const iso = toISODateLocal(new Date());
      const todayTotal = getDayTotal(iso);
      const prefill = (state.lastAmount || "10").replace(/[^\d]/g,"") || "10";

      openSheet("LOG PUSHUPS", `
        <div class="amountDisplay">
          <div class="amountValue" id="amtVal">${prefill}</div>
          <div class="amountSub" id="amtSub">Adds to today • Preview: <strong id="previewText">+${prefill} → Today: ${Math.min(9999, todayTotal + Number(prefill||0))}/${GOAL}</strong></div>
        </div>

        <div class="chips">
          ${[5,10,15,20,25].map(n => `<button class="chip" data-chip="${n}">${n}</button>`).join("")}
        </div>

        <div class="numpad" aria-label="Numpad">
          ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="key" data-key="${n}">${n}</button>`).join("")}
          <button class="key dim" data-back="1">⌫</button>
          <button class="key" data-key="0">0</button>
          <button class="key dim" data-clear="1">C</button>
        </div>

        <div class="okRow">
          <button class="okBtn" id="okBtn">OK</button>
        </div>
      `);

      // Wire up interactions
      const amtVal = document.getElementById("amtVal");
      const previewText = document.getElementById("previewText");
      const okBtn = document.getElementById("okBtn");

      let val = String(prefill);

      function clampValStr(s){
        s = (s || "").replace(/[^\d]/g,"");
        // avoid leading zeros (but allow "0" while typing)
        if(s.length > 1) s = s.replace(/^0+/,"");
        if(s === "") s = "0";
        if(s.length > 4) s = s.slice(0,4);
        return s;
      }

      function render(){
        val = clampValStr(val);
        const n = Number(val || 0);
        amtVal.textContent = val;
        const newTotal = todayTotal + n;
        previewText.textContent = `+${n} → Today: ${newTotal}/${GOAL}`;
        okBtn.disabled = !(n > 0);
      }

      sheetBody.querySelectorAll("[data-chip]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          val = String(btn.getAttribute("data-chip"));
          render();
        });
      });

      sheetBody.querySelectorAll("[data-key]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const k = btn.getAttribute("data-key");
          // Replace "0" with first digit, otherwise append
          if(val === "0") val = k;
          else val = val + k;
          render();
        });
      });

      sheetBody.querySelector("[data-back]")?.addEventListener("click", ()=>{
        val = val.length <= 1 ? "0" : val.slice(0,-1);
        render();
      });

      sheetBody.querySelector("[data-clear]")?.addEventListener("click", ()=>{
        val = "0";
        render();
      });

      okBtn.addEventListener("click", ()=>{
        const n = Number(val || 0);
        if(!(n > 0)) return;
        state.lastAmount = String(n);
        addReps(n);
        closeSheet();
      });

      render();
    }

    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);

      const prevTotal = day.total;
      day.total += Math.floor(n);
      day.entries.push({ ts: Date.now(), n: Math.floor(n) });

      state.lifetime = (state.lifetime || 0) + Math.floor(n);

      saveState();
      renderAll();

      // Micro animations: pop today
      triggerPop(todayText);

      // Celebrate when hitting goal first time today
      if(prevTotal < GOAL && day.total >= GOAL){
        burstConfetti();
      }
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;

      const last = day.entries.pop();
      const dec = (last?.n ?? 0);

      day.total = Math.max(0, day.total - dec);
      state.lifetime = Math.max(0, (state.lifetime || 0) - dec);

      if(day.total === 0 && day.entries.length === 0){
        delete state.days[iso];
      }

      saveState();
      renderAll();
      triggerPop(todayText);
    }

    // ===== Reset (hold to confirm) =====
    function attachHoldToConfirm(btn, onConfirm){
      let t = null;
      let holding = false;

      const start = () => {
        if(holding) return;
        holding = true;
        btn.classList.add("holding");
        btn.textContent = "Hold…";
        t = setTimeout(() => {
          holding = false;
          btn.classList.remove("holding");
          btn.textContent = "Hold to reset today";
          onConfirm();
        }, 900);
      };

      const cancel = () => {
        if(t) clearTimeout(t);
        t = null;
        if(holding){
          holding = false;
          btn.classList.remove("holding");
          btn.textContent = "Hold to reset today";
        }
      };

      btn.addEventListener("pointerdown", start);
      btn.addEventListener("pointerup", cancel);
      btn.addEventListener("pointercancel", cancel);
      btn.addEventListener("pointerleave", cancel);
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      const day = state.days[iso];
      if(day){
        // adjust lifetime by today's total (approx; based on entries)
        const sum = (day.entries || []).reduce((a,e)=> a + (e?.n||0), 0);
        state.lifetime = Math.max(0, (state.lifetime||0) - sum);
      }
      delete state.days[iso];
      saveState();
      renderAll();
    }

    // ===== Calendar day details =====
    function openDayDetails(iso){
      const d = getDay(iso);
      const total = d?.total ?? 0;
      const entries = (d?.entries ?? []).slice().sort((a,b)=> (a.ts||0) - (b.ts||0));

      openSheet(`DAY DETAILS`, `
        <div class="detailBox">
          <div class="detailTop">
            <div>${iso}</div>
            <div>Total: <strong>${total}</strong></div>
          </div>

          <div class="logs">
            ${entries.length ? entries.map(e => `
              <div class="logRow">
                <span>+${e.n}</span>
                <span>${fmtTime(e.ts)}</span>
              </div>
            `).join("") : `<div style="color: rgba(244,241,233,.65); font-size: 12px;">No logs.</div>`}
          </div>
        </div>

        <button class="dangerHold" id="clearDayHold">Hold to clear this day</button>
      `);

      const clearBtn = document.getElementById("clearDayHold");
      attachHoldToConfirm(clearBtn, ()=>{
        // reduce lifetime by that day's entries
        const sum = (d?.entries || []).reduce((a,e)=> a + (e?.n||0), 0);
        state.lifetime = Math.max(0, (state.lifetime||0) - sum);
        delete state.days[iso];
        saveState();
        renderAll();
        closeSheet();
      });
    }

    // ===== Rendering =====
    function renderStateCopy(todayTotal){
      const pct = Math.round(Math.min(100, (todayTotal / GOAL) * 100));
      if(todayTotal >= GOAL){
        stateTitle.textContent = "DONE FOR TODAY";
        stateCopy.textContent = "Goal smashed. You’re a machine.";
        return;
      }

      stateTitle.textContent = "KEEP GOING";

      if(todayTotal <= 9) stateCopy.textContent = "You can do it. Start with 10.";
      else if(todayTotal <= 29) stateCopy.textContent = "Nice start — keep the rhythm.";
      else if(todayTotal <= 59) stateCopy.textContent = "Halfway vibes. Don’t give up.";
      else if(todayTotal <= 99) stateCopy.textContent = "Almost there. Finish strong.";
      else stateCopy.textContent = "Goal smashed. You’re a machine.";
    }

    function renderTop(){
      const iso = toISODateLocal(new Date());
      const todayTotal = getDayTotal(iso);
      const remaining = Math.max(0, GOAL - todayTotal);
      const pct = Math.max(0, Math.min(100, Math.round((todayTotal / GOAL) * 100)));

      todayText.textContent = `TODAY: ${todayTotal} / ${GOAL}`;
      remainingText.textContent = remaining;
      remainingText2.textContent = remaining;
      pctText.textContent = `${pct}%`;
      barFill.style.width = `${pct}%`;

      // streak
      const streak = calcStreak();
      streakText.textContent = streak;

      // level from lifetime
      const lifetime = state.lifetime || 0;
      const { lvl, nextIn } = calcLevelFromLifetime(lifetime);
      levelText.textContent = `Level ${lvl}`;
      nextLevelText.textContent = nextIn;

      // state copy (5 steps)
      renderStateCopy(todayTotal);

      // avatar by streak
      const avLvl = levelFromStreak(streak);
      avatarImg.src = AVATARS[avLvl] || AVATARS[0];
      avatarMeta.textContent = `LEVEL ${avLvl}`;
      avatarHint.textContent = avatarHints[avLvl] || "Keep it going.";

      const glowByLevel = [0.06, 0.12, 0.20, 0.32, 0.45, 0.60];
      avatarBlock.style.setProperty("--pGlow", String(glowByLevel[avLvl] ?? 0.08));
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthName(m)} ${y}`;
      calGrid.innerHTML = "";

      const dows = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const firstLogged = Object.keys(state.days).sort()[0] || null;

      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7; // Monday=0
      const daysInMonth = new Date(y, m + 1, 0).getDate();
      const todayIso = toISODateLocal(new Date());

      // blanks
      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"></div><div class="dayval"></div>`;
        calGrid.appendChild(ghost);
      }

      // for streak visuals: mark consecutive done days ending today-1 or today if done
      // We'll build a quick set of iso dates in current month that are in streak chain
      const streakChain = new Set();
      {
        const d = new Date();
        while(true){
          const iso = toISODateLocal(d);
          if(getDayTotal(iso) >= GOAL){
            streakChain.add(iso);
            d.setDate(d.getDate()-1);
          } else break;
        }
      }

      for(let dayNum=1; dayNum<=daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);

        // state mapping
        let cls = "day";
        if(!firstLogged || iso < firstLogged){
          cls += " before";
        } else {
          if(total >= GOAL) cls += " done";
          else if(total > 0) cls += " started";
          else cls += " missed";
        }

        if(iso === todayIso) cls += " today";
        if(streakChain.has(iso)) cls += " streak";

        const cell = document.createElement("div");
        cell.className = cls;

        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval">${total ? total : ""}</div>
        `;

        // Only interactive if you've "started" the app (>= firstLogged)
        if(firstLogged && iso >= firstLogged){
          cell.addEventListener("click", ()=> openDayDetails(iso));
        } else {
          cell.classList.add("off");
        }

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderTop();
      renderCalendar();
    }

    // ===== EVENTS =====
    logBtn.addEventListener("click", openLogSheet);
    openLogBtn.addEventListener("click", openLogSheet);

    undoBtn.addEventListener("click", undoLast);

    menuBtn.addEventListener("click", ()=>{
      const show = menuPanel.style.display !== "none";
      menuPanel.style.display = show ? "none" : "block";
    });

    attachHoldToConfirm(resetHoldBtn, ()=>{
      resetToday();
      menuPanel.style.display = "none";
    });

    prevMonthBtn.addEventListener("click", ()=>{
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", ()=>{
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", ()=>{
      currentMonth = new Date();
      currentMonth.setDate(1);
      renderAll();
    });

    // ===== INIT =====
    renderAll();

    // Loading animation
    function runLoading(){
      const durationMs = 650;
      const start = performance.now();

      function tick(now){
        const t = Math.min(1, (now - start) / durationMs);
        const eased = 1 - Math.pow(1 - t, 3);
        loadingCount.textContent = Math.round(eased * 100);
        if(t < 1) requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
      setTimeout(() => loading.classList.add("hidden"), 900);
    }
    window.addEventListener("load", runLoading);
  </script>
</body>
</html>


