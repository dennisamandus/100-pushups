<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 Pushups</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#14161d;
      --text:#e8e8ea;
      --muted:#a8abb6;
      --border:#2a2d38;

      --green:#1f8a4c;
      --orange:#c77d1a;
      --red:#a13232;
      --gray:#3a3f52;

      --btn:#1a1e2a;
      --btn2:#0f1118;
      --soft: rgba(255,255,255,0.06);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== Loading screen ===== */
    .loading{
      position: fixed;
      inset: 0;
      background: var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      transition: opacity 420ms ease, visibility 420ms ease;
    }
    .loading.hidden{
      opacity: 0;
      visibility: hidden;
    }
    .loadingCard{
      width: min(560px, calc(100vw - 32px));
      border-radius: 18px;
      border: 1px solid var(--border);
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(255,255,255,0.07), transparent 60%),
        var(--panel);
      padding: 18px;
      text-align:center;
      overflow:hidden;
      position: relative;
    }
    .loadingTitle{
      font-weight: 1000;
      letter-spacing: 0.9px;
      text-transform: uppercase;
      font-size: 18px;
      line-height: 1.2;
    }
    .loadingCount{
      margin-top: 14px;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 52px;
      font-weight: 1000;
      letter-spacing: 0.5px;
      opacity: 0.95;
    }
    .dots{
      margin-top: 12px;
      display:flex;
      justify-content:center;
      gap: 8px;
    }
    .dot{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.20);
      animation: pulse 900ms ease-in-out infinite;
    }
    .dot:nth-child(2){ animation-delay: 120ms; }
    .dot:nth-child(3){ animation-delay: 240ms; }
    @keyframes pulse{
      0%,100%{ transform: translateY(0); opacity: 0.35; }
      50%{ transform: translateY(-4px); opacity: 0.95; }
    }
    .shine{
      position:absolute;
      inset: -40% -60%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
      transform: rotate(12deg);
      animation: sweep 1400ms ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{
      0%{ transform: translateX(-20%) rotate(12deg); opacity: 0; }
      20%{ opacity: 1; }
      100%{ transform: translateX(20%) rotate(12deg); opacity: 0; }
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 22px;
      display:grid;
      gap: 12px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.05fr 1fr; align-items:start; }
    }
    .card{
      border-radius: 18px;
      border: 1px solid var(--border);
      background:
        radial-gradient(1200px 600px at 50% 0%, rgba(255,255,255,0.06), transparent 60%),
        var(--panel);
      padding: 14px;
    }

    /* ===== Block 1: Counter ===== */
    .tapArea{
      position: relative;
      overflow: hidden;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(15,17,24,0.60);
      padding: 14px;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }
    .topLabel{
      text-align:center;
      font-weight: 1000;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--muted);
    }
    .big{
      margin-top: 10px;
      text-align:center;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: clamp(80px, 17vw, 124px);
      font-weight: 1000;
      line-height: 1;
      letter-spacing: 0.5px;
    }
    .metaRow{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap: 8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
    }

    /* Ripple on tap */
    .ripple{
      position:absolute;
      border-radius: 999px;
      transform: translate(-50%,-50%);
      pointer-events:none;
      background: rgba(255,255,255,0.10);
      animation: ripple 520ms ease-out forwards;
      mix-blend-mode: screen;
    }
    @keyframes ripple{
      from{ width: 0; height: 0; opacity: 0.55; }
      to{ width: 520px; height: 520px; opacity: 0; }
    }

    .controls{
      margin-top: 12px;
      display:grid;
      gap: 10px;
    }
    .sectionLabel{
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.2px;
      margin-left: 2px;
    }
    .stepGrid{
      display:grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 8px;
    }
    button, input{
      font: inherit;
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 12px;
      background: var(--btn2);
      color: var(--text);
      outline: none;
    }
    button{
      cursor:pointer;
      background: var(--btn);
      font-weight: 950;
      touch-action: manipulation;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    .stepBtn{
      padding: 12px 8px;
      border-radius: 16px;
      background: transparent;
      font-weight: 1000;
    }
    .stepBtn.active{
      background: var(--soft);
      border-color: rgba(255,255,255,0.18);
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .row > *{ flex: 1; }

    .btnGood{ background:#102316; border-color:#234b33; }
    .btnGhost{ background: transparent; }
    .btnDanger{ background:#2a1212; border-color:#4a1b1b; }

    input{ width: 100%; }
    @media (min-width: 860px){
      .row > input{ flex: 2; }
      .row > button{ flex: 1; }
    }

    /* ===== Block 2: Pep + progress + calendar ===== */
    .pep{
      font-weight: 1000;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--muted);
      text-align:center;
      margin-bottom: 10px;
    }
    .progressBig{
      text-align:center;
      font-weight: 1000;
      font-size: 46px;
      letter-spacing: 0.2px;
      line-height: 1.05;
    }
    .progressSub{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }
    .bar{
      margin: 14px 6px 2px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 0%;
      background: rgba(31,138,76,0.85);
      transition: width 250ms ease;
    }

    /* Calendar */
    .calHead{
      margin-top: 14px;
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
    }
    .calTitle{
      font-weight: 1000;
      font-size: 15px;
      letter-spacing: 0.2px;
    }
    .calBtns{ display:flex; gap:8px; }

    .cal{
      margin-top: 8px;
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
    }
    .dow{
      font-size: 11px;
      color: var(--muted);
      text-align:center;
      padding: 4px 0 6px;
    }
    .day{
      height: clamp(44px, 9.8vw, 62px);
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #0f1118;
      padding: 7px 7px 6px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      min-width:0;
    }
    .day.off{ opacity:0.35; cursor:default; }
    .daynum{ font-weight:1000; font-size: 13px; line-height:1; }
    .dayval{
      font-size: 12px;
      color: var(--muted);
      text-align:right;
      line-height:1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    .day.gray{ border-color: rgba(58,63,82,0.95); }
    .day.red{ border-color: rgba(161,50,50,0.70); }
    .day.orange{ border-color: rgba(199,125,26,0.80); }
    .day.green{ border-color: rgba(31,138,76,0.80); }
  </style>
</head>

<body>
  <!-- Loading screen -->
  <div class="loading" id="loading">
    <div class="loadingCard">
      <div class="shine"></div>
      <div class="loadingTitle">100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY</div>
      <div class="loadingCount" id="loadingCount">0</div>
      <div class="dots" aria-label="Loading">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- Block 1 -->
      <div class="card">
        <div class="tapArea" id="tapArea" aria-label="Tap to add">
          <div class="topLabel">LET’S GO!</div>
          <div class="big" id="todayTotal">0</div>

          <div class="metaRow">
            <span class="pill">LEFT: <span id="todayLeft">100</span></span>
            <span class="pill">STREAK: <span id="streakTop">0</span></span>
          </div>
        </div>

        <div class="controls">
          <div class="sectionLabel">STEP (tap adds this amount)</div>
          <div class="stepGrid" id="stepGrid" aria-label="Step">
            <button class="stepBtn" data-step="1">1</button>
            <button class="stepBtn" data-step="5">5</button>
            <button class="stepBtn" data-step="10">10</button>
            <button class="stepBtn" data-step="15">15</button>
            <button class="stepBtn" data-step="20">20</button>
            <button class="stepBtn" data-step="25">25</button>
          </div>

          <div class="row">
            <input id="addInput" type="number" inputmode="numeric" min="1" placeholder="Custom amount (e.g. 12)" />
            <button id="addBtn" class="btnGood">Add</button>
          </div>

          <div class="row">
            <button id="undoBtn" class="btnGhost">Undo last</button>
            <button id="resetTodayBtn" class="btnDanger">Reset today</button>
          </div>
        </div>
      </div>

      <!-- Block 2 -->
      <div class="card">
        <div class="pep">KEEP GOING</div>
        <div class="progressBig" id="progressBig">0%</div>
        <div class="progressSub">STREAK: <span id="streakBottom">0</span></div>

        <div class="bar"><div id="barFill"></div></div>

        <div class="calHead">
          <div class="calTitle" id="calTitle">—</div>
          <div class="calBtns">
            <button id="prevMonthBtn" class="btnGhost" aria-label="Previous month">◀</button>
            <button id="todayBtn" class="btnGhost">Today</button>
            <button id="nextMonthBtn" class="btnGhost" aria-label="Next month">▶</button>
          </div>
        </div>

        <div class="cal" id="calGrid"></div>
      </div>
    </div>
  </div>

  <script>
    // Fixed goal
    const GOAL = 100;

    // Keep your existing device data
    const STORAGE_KEY = "pushups_simple_v2";

    // Helpers
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    const monthName = (m) => ["January","February","March","April","May","June","July","August","September","October","November","December"][m];

    function defaultState(){
      return { days: {}, step: 10 };
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return defaultState();
        if(!parsed.days || typeof parsed.days !== "object") parsed.days = {};
        if(typeof parsed.step !== "number" || parsed.step <= 0) parsed.step = 10;

        for(const k of Object.keys(parsed.days)){
          const day = parsed.days[k];
          if(!day || typeof day !== "object") { delete parsed.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return parsed;
      }catch{
        return defaultState();
      }
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function ensureDay(iso){
      if(!state.days[iso]) state.days[iso] = { total: 0, entries: [] };
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    let state = loadState();
    let currentMonth = new Date(); currentMonth.setDate(1);

    // DOM
    const loading = document.getElementById("loading");
    const loadingCount = document.getElementById("loadingCount");

    const tapArea = document.getElementById("tapArea");
    const todayTotalEl = document.getElementById("todayTotal");
    const todayLeftEl = document.getElementById("todayLeft");
    const streakTop = document.getElementById("streakTop");
    const streakBottom = document.getElementById("streakBottom");

    const progressBig = document.getElementById("progressBig");
    const barFill = document.getElementById("barFill");

    const stepGrid = document.getElementById("stepGrid");
    const addInput = document.getElementById("addInput");
    const addBtn = document.getElementById("addBtn");
    const undoBtn = document.getElementById("undoBtn");
    const resetTodayBtn = document.getElementById("resetTodayBtn");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    function getFirstLoggedISO(){
      const keys = Object.keys(state.days);
      if(keys.length === 0) return null;
      keys.sort();
      return keys[0];
    }
    function getDayTotal(iso){ return state.days[iso]?.total ?? 0; }

    function getDayStatus(iso, total, firstISO){
      if(!firstISO) return "gray";
      if(iso < firstISO) return "gray";
      if(total >= GOAL) return "green";
      if(total > 0) return "orange";
      return "red";
    }

    function calcStreak(){
      let s = 0;
      const d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        if(getDayTotal(iso) >= GOAL){
          s++;
          d.setDate(d.getDate()-1);
        }else break;
      }
      return s;
    }

    function setStep(n){
      state.step = n;
      saveState();
      renderStepUI();
    }

    function renderStepUI(){
      stepGrid.querySelectorAll("button[data-step]").forEach(b => {
        b.classList.toggle("active", Number(b.dataset.step) === state.step);
      });
    }

    function rippleAt(x, y){
      const r = document.createElement("span");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top = y + "px";
      tapArea.appendChild(r);
      setTimeout(() => r.remove(), 600);
    }

    function maybeVibrate(){
      try{ if(navigator.vibrate) navigator.vibrate(10); } catch{}
    }

    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const add = Math.floor(n);
      day.total += add;
      day.entries.push({ ts: Date.now(), n: add });
      saveState();
      renderAll();
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;
      const last = day.entries.pop();
      day.total = Math.max(0, day.total - (last?.n ?? 0));
      if(day.total === 0 && day.entries.length === 0) delete state.days[iso];
      saveState();
      renderAll();
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      delete state.days[iso];
      saveState();
      renderAll();
    }

    function renderToday(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const total = day.total;

      todayTotalEl.textContent = total;
      todayLeftEl.textContent = Math.max(0, GOAL - total);

      const streak = calcStreak();
      streakTop.textContent = streak;
      streakBottom.textContent = streak;

      const pct = Math.max(0, Math.min(100, Math.round((total / GOAL) * 100)));
      progressBig.textContent = `${pct}%`;
      barFill.style.width = `${pct}%`;
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthName(m)} ${y}`;
      calGrid.innerHTML = "";

      const dows = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const firstISO = getFirstLoggedISO();
      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7; // Monday=0
      const daysInMonth = new Date(y, m + 1, 0).getDate();

      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"></div><div class="dayval"></div>`;
        calGrid.appendChild(ghost);
      }

      for(let dayNum=1; dayNum<=daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatus(iso, total, firstISO);

        const cell = document.createElement("div");
        cell.className = `day ${st}`;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval">${total ? total : ""}</div>
        `;

        // Simple: tap a day to reset
        cell.addEventListener("click", () => {
          if(confirm(`Reset ${iso}?`)){
            delete state.days[iso];
            saveState();
            renderAll();
          }
        });

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderStepUI();
      renderToday();
      renderCalendar();
    }

    // Events
    tapArea.addEventListener("pointerdown", (e) => {
      const rect = tapArea.getBoundingClientRect();
      rippleAt(e.clientX - rect.left, e.clientY - rect.top);
      maybeVibrate();
      addReps(state.step);
    });

    stepGrid.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-step]");
      if(!btn) return;
      setStep(Number(btn.dataset.step));
    });

    addBtn.addEventListener("click", () => {
      const n = Number(addInput.value);
      addInput.value = "";
      addInput.focus();
      addReps(n);
    });
    addInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") addBtn.click();
    });

    undoBtn.addEventListener("click", undoLast);
    resetTodayBtn.addEventListener("click", () => {
      if(confirm("Reset today?")) resetToday();
    });

    prevMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      currentMonth = new Date(); currentMonth.setDate(1);
      renderAll();
    });

    // Init
    renderAll();

    // Loading animation: count 0 -> 100, then fade
    function runLoading(){
      const durationMs = 650;
      const start = performance.now();

      function tick(now){
        const t = Math.min(1, (now - start) / durationMs);
        const eased = 1 - Math.pow(1 - t, 3);
        loadingCount.textContent = Math.round(eased * 100);
        if(t < 1) requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
      setTimeout(() => loading.classList.add("hidden"), 900);
    }

    window.addEventListener("load", runLoading);
  </script>
</body>
</html>
