<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 Pushups</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0c;
      --panel:#121214;
      --panel2:#0f0f11;
      --cream:#f4f1e9;
      --muted:rgba(244,241,233,.72);
      --muted2:rgba(244,241,233,.55);
      --border:rgba(244,241,233,.10);

      --accent:#e33b2f;
      --accent2:#ff7a2f;

      --shadow: rgba(0,0,0,.45);
      --radius:18px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% -10%, rgba(227,59,47,.16), transparent 55%),
        radial-gradient(900px 600px at 80% 0%, rgba(255,122,47,.10), transparent 60%),
        var(--bg);
      color:var(--cream);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== Loading (dramatic) ===== */
    .loading{
      position: fixed; inset: 0;
      background:
        radial-gradient(900px 520px at 50% 0%, rgba(227,59,47,.22), transparent 60%),
        radial-gradient(700px 460px at 80% 10%, rgba(255,122,47,.16), transparent 60%),
        var(--bg);
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
      transition: opacity 520ms ease, visibility 520ms ease;
    }
    .loading.hidden{ opacity:0; visibility:hidden; }
    .loadingCard{
      width: min(560px, calc(100vw - 32px));
      border-radius: 22px;
      border: 1px solid var(--border);
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(244,241,233,0.09), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.05), transparent),
        rgba(18,18,20,.92);
      padding: 18px;
      text-align:center;
      overflow:hidden;
      position: relative;
      box-shadow: 0 24px 70px rgba(0,0,0,.65);
    }
    .loadingTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.8px;
      text-transform: uppercase;
      font-size: 16px;
      line-height: 1.1;
      color: rgba(244,241,233,.98);
    }
    .loadingCount{
      margin-top: 14px;
      font-variant-numeric: tabular-nums;
      font-family: "Space Grotesk", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 58px;
      font-weight: 700;
      letter-spacing: 0.8px;
      opacity: .98;
      text-shadow: 0 0 30px rgba(227,59,47,.18);
    }
    .sparkline{
      margin: 10px auto 0;
      width: 160px; height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(227,59,47,.55), rgba(255,122,47,.55), transparent);
      animation: glow 900ms ease-in-out infinite;
      opacity: .9;
    }
    @keyframes glow{
      0%,100%{ transform: scaleX(.85); opacity: .55; }
      50%{ transform: scaleX(1.05); opacity: .95; }
    }
    .shine{
      position:absolute; inset: -40% -60%;
      background: linear-gradient(90deg, transparent, rgba(244,241,233,0.14), transparent);
      transform: rotate(12deg);
      animation: sweep 1200ms ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{
      0%{ transform: translateX(-25%) rotate(12deg); opacity: 0; }
      20%{ opacity: 1; }
      100%{ transform: translateX(25%) rotate(12deg); opacity: 0; }
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 14px 24px;
      display:grid;
      gap: 12px;
    }
    .topHero{ text-align:center; padding: 6px 2px 2px; }
    .heroTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.6px;
      text-transform: uppercase;
      font-size: 16px;
      line-height: 1.15;
      color: rgba(244,241,233,.95);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.1fr 0.9fr; align-items:start; }
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background:
        radial-gradient(1200px 600px at 50% 0%, rgba(244,241,233,0.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.03), transparent),
        var(--panel);
      padding: 14px;
      box-shadow: 0 16px 40px var(--shadow);
    }

    /* ===== TODAY + Clicker ===== */
    .todayLine{ display:flex; justify-content:center; padding-top: 8px; }
    .todayBig{
      font-family: "Space Grotesk", Inter, system-ui;
      font-size: clamp(40px, 9vw, 64px);
      font-weight: 700;
      line-height: 1;
    }

    .statsRow{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      gap: 10px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
      white-space: nowrap;
    }
    .pill strong{ color: rgba(244,241,233,.92); font-weight: 900; }

    .progressWrap{
      margin-top: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding: 12px;
    }
    .progressTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    .bar{
      margin-top: 10px;
      height: 12px;
      border-radius: 999px;
      background: rgba(244,241,233,0.08);
      border: 1px solid var(--border);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 160ms ease;
    }

    .clickerWrap{
      margin-top: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 12px;
      overflow:hidden;
      position: relative;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .clickerTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--muted);
      text-align:center;
      margin-bottom: 10px;
    }

    .bigClick{
      width:100%;
      border: 1px solid rgba(244,241,233,.12);
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: rgba(244,241,233,.97);
      border-radius: 18px;
      padding: 18px 14px;
      cursor:pointer;
      box-shadow: 0 16px 44px rgba(227,59,47,.18);
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 18px;
    }
    .bigClick:active{ transform: translateY(1px); }
    .bigSub{
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      margin-top: 8px;
    }

    .quickRow{
      margin-top: 10px;
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .qbtn{
      border: 1px solid rgba(244,241,233,.12);
      background: rgba(255,255,255,.04);
      color: rgba(244,241,233,.95);
      border-radius: 16px;
      padding: 12px 12px;
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: .6px;
      cursor:pointer;
      text-transform: uppercase;
    }
    .qbtn:active{ transform: translateY(1px); }

    .linkBtn{
      width: 100%;
      margin-top: 10px;
      background: transparent;
      border: none;
      color: rgba(244,241,233,.75);
      font-weight: 800;
      padding: 10px 0;
      cursor:pointer;
      text-decoration: underline;
      text-underline-offset: 4px;
    }
    .linkBtn:hover{ color: rgba(244,241,233,.95); }

    /* ripple */
    .ripple{
      position:absolute;
      border-radius: 999px;
      transform: translate(-50%,-50%);
      pointer-events:none;
      background: rgba(244,241,233,0.14);
      animation: ripple 520ms ease-out forwards;
      mix-blend-mode: screen;
    }
    @keyframes ripple{
      from{ width: 0; height: 0; opacity: 0.55; }
      to{ width: 520px; height: 520px; opacity: 0; }
    }

    /* pop on TODAY */
    .pop{ animation: pop 220ms ease-out; }
    @keyframes pop{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.04); }
      100%{ transform: scale(1); }
    }

    /* toast */
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      background: rgba(18,18,20,.92);
      border: 1px solid var(--border);
      color: rgba(244,241,233,.95);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      letter-spacing: .4px;
      box-shadow: 0 14px 44px rgba(0,0,0,.55);
      opacity: 0;
      pointer-events:none;
      transition: opacity 160ms ease, transform 160ms ease;
      z-index: 80;
      white-space: nowrap;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-6px);
    }

    /* confetti */
    .confetti{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 90;
      overflow:hidden;
      display:none;
    }
    .confetti.show{ display:block; }
    .confetti i{
      position:absolute;
      top:-10px;
      width: 10px;
      height: 14px;
      border-radius: 2px;
      opacity:.9;
      animation: fall 900ms ease-out forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    /* ===== Right: Copy + Avatar ===== */
    .stateTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1.1px;
      text-transform: uppercase;
      font-size: 13px;
      color: rgba(244,241,233,.85);
      text-align:center;
      margin-top: 6px;
    }
    .stateCopy{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }

    .avatarBlock{
      margin-top: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      padding: 14px;
      position: relative;
      overflow: hidden;
    }
    .avatarTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--muted);
      text-align:center;
    }
    .avatarWrap{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .avatarImg{
      width: 180px;
      height: auto;
      filter: drop-shadow(0 0 calc(22px * var(--pGlow,0.08)) rgba(227,59,47,var(--pGlow,0.14)));
    }
    .streakCounter{
      margin-top: 10px;
      text-align:center;
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 14px;
      color: rgba(244,241,233,.92);
    }
    .streakMini{
      margin-top: 6px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
    }

    .streakBarWrap{
      margin-top: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding: 12px;
    }
    .streakBarTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .2px;
      color: var(--muted);
    }
    .streakBarTop strong{ color: rgba(244,241,233,.95); font-weight: 900; }
    .streakBar{
      margin-top: 10px;
      height: 12px;
      border-radius: 999px;
      background: rgba(244,241,233,0.08);
      border: 1px solid var(--border);
      overflow:hidden;
      position: relative;
    }
    .streakFill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(255,122,47,.55), rgba(227,59,47,.95));
      transition: width 160ms ease;
    }

    /* ===== Calendar (bottom) ===== */
    .calHead{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }
    .calTitle{
      font-family: "Space Grotesk", Inter, system-ui;
      font-weight: 700;
      font-size: 15px;
      letter-spacing: 0.2px;
    }
    .calBtns{ display:flex; gap:8px; }
    .btnGhost{
      background: transparent;
      border: 1px solid var(--border);
      color: rgba(244,241,233,.9);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 800;
    }

    .cal{
      margin-top: 8px;
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
    }
    .dow{
      font-size: 11px;
      color: var(--muted2);
      text-align:center;
      padding: 4px 0 6px;
      text-transform: uppercase;
      letter-spacing: .3px;
    }
    .day{
      height: clamp(44px, 9.8vw, 62px);
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.20);
      padding: 7px 7px 6px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      user-select:none;
      overflow:hidden;
      min-width:0;
      position: relative;
    }
    .day.off{ opacity:0.25; }
    .daynum{ font-weight:900; font-size: 13px; line-height:1; }
    .dayval{
      font-size: 12px;
      color: rgba(244,241,233,.70);
      text-align:right;
      line-height:1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }

    /* calendar states */
    .day.before{ opacity:.35; }
    .day.missed{ opacity:.55; }
    .day.started{
      opacity: 1;
      border-color: rgba(255,122,47,.35);
      background: rgba(255,122,47,.08);
    }
    .day.done{
      opacity: 1;
      border-color: rgba(227,59,47,.55);
      background: rgba(227,59,47,.22);
    }
    .day.today{
      box-shadow: 0 0 0 2px rgba(227,59,47,.40) inset, 0 0 28px rgba(227,59,47,.18);
    }
    .day.streak::after{
      content:"";
      position:absolute;
      left:10px; right:10px; bottom:8px;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,122,47,.0), rgba(255,122,47,.7), rgba(227,59,47,.8));
      opacity: .75;
      pointer-events:none;
    }
  </style>
</head>

<body>
  <div class="loading" id="loading">
    <div class="loadingCard">
      <div class="shine"></div>
      <div class="loadingTitle" id="loadingTitle">THE 100 CLUB</div>
      <div class="loadingCount" id="loadingCount">0</div>
      <div class="sparkline"></div>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>
  <div class="toast" id="toast">+1 added</div>

  <div class="wrap">
    <div class="topHero">
      <div class="heroTitle" id="heroTitle">CONSISTENCY MODE</div>
    </div>

    <!-- TOP GRID -->
    <div class="grid">
      <!-- LEFT: Today + Clicker -->
      <div class="card">
        <div class="todayLine">
          <div class="todayBig" id="todayText">TODAY: 0 / 100</div>
        </div>

        <div class="statsRow">
          <div class="pill">REMAINING: <strong id="remainingText">100</strong></div>
          <div class="pill">STREAK: <strong id="streakText">0</strong> days</div>
        </div>

        <div class="progressWrap">
          <div class="progressTop">
            <div><span id="pctText">0%</span> complete</div>
            <div>Remaining: <span id="remainingText2">100</span></div>
          </div>
          <div class="bar"><div id="barFill"></div></div>
        </div>

        <div class="clickerWrap" id="clickerWrap">
          <div class="clickerTitle">CLICKER MODE</div>
          <button class="bigClick" id="clickBtn">+1 PUSHUP</button>
          <div class="bigSub">Tap to log 1. Keep it fun.</div>

          <div class="quickRow" aria-label="Boosters">
            <button class="qbtn" data-add="5">+5</button>
            <button class="qbtn" data-add="10">+10</button>
          </div>

          <button class="linkBtn" id="undoBtn">Undo last</button>
        </div>
      </div>

      <!-- RIGHT: Copy + Avatar/Streak -->
      <div class="card">
        <div class="stateTitle" id="stateTitle">KEEP GOING</div>
        <div class="stateCopy" id="stateCopy">You can do it. Start with 10.</div>

        <div class="avatarBlock" id="avatarBlock">
          <div class="avatarTitle">STREAK AVATAR</div>
          <div class="avatarWrap">
            <img id="avatarImg" class="avatarImg" src="avatar_0.png" alt="Streak avatar">
          </div>

          <div class="streakCounter" id="streakCounter">STREAK: 0 DAYS</div>
          <div class="streakMini" id="streakMini">Complete 100 today to keep your power.</div>

          <div class="streakBarWrap">
            <div class="streakBarTop">
              <div>Next milestone</div>
              <div><strong id="streakNow">0</strong> / <span id="streakCap">7</span></div>
            </div>
            <div class="streakBar"><div class="streakFill" id="streakFill"></div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- CALENDAR BOTTOM -->
    <div class="card">
      <div class="calHead">
        <div class="calTitle" id="calTitle">—</div>
        <div class="calBtns">
          <button class="btnGhost" id="prevMonthBtn">◀</button>
          <button class="btnGhost" id="todayBtn">Today</button>
          <button class="btnGhost" id="nextMonthBtn">▶</button>
        </div>
      </div>

      <div class="cal" id="calGrid"></div>
    </div>
  </div>

  <script>
    // ===== Config =====
    const GOAL = 100;
    const STORAGE_KEY = "pushups_clicker_v1";

    const TITLES = [
      "100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY",
      "THE 100 CLUB",
      "COUNT IT. EARN IT.",
      "CONSISTENCY MODE",
      "STACK THE REPS",
      "STREAK POWER",
      "ONE HUNDRED. EVERY DAY."
    ];

    // Avatar images in repo root
    const AVATARS = [
      "avatar_0.png",
      "avatar_1.png",
      "avatar_2.png",
      "avatar_3.png",
      "avatar_4.png",
      "avatar_5.png"
    ];

    function levelFromStreak(streak){
      if(streak <= 0) return 0;
      if(streak <= 2) return 1;
      if(streak <= 6) return 2;
      if(streak <= 13) return 3;
      if(streak <= 20) return 4;
      return 5;
    }

    const STREAK_CAPS = [3, 7, 14, 21, 30];
    function nextStreakCap(streak){
      for(const c of STREAK_CAPS){
        if(streak < c) return c;
      }
      return STREAK_CAPS[STREAK_CAPS.length - 1];
    }

    // ===== Helpers =====
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    const monthName = (m) => ["January","February","March","April","May","June","July","August","September","October","November","December"][m];

    function defaultState(){
      return { days: {} }; // days[iso] = { total, entries:[{ts,n}] }
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const s = JSON.parse(raw);
        if(!s || typeof s !== "object") return defaultState();
        if(!s.days || typeof s.days !== "object") s.days = {};
        for(const k of Object.keys(s.days)){
          const day = s.days[k];
          if(!day || typeof day !== "object") { delete s.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return s;
      }catch{
        return defaultState();
      }
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function ensureDay(iso){
      if(!state.days[iso]) state.days[iso] = { total: 0, entries: [] };
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    function getDayTotal(iso){ return state.days[iso]?.total ?? 0; }

    function calcStreak(){
      let s = 0;
      const d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        if(getDayTotal(iso) >= GOAL){
          s++;
          d.setDate(d.getDate()-1);
        }else break;
      }
      return s;
    }

    function pickTitle(){ return TITLES[Math.floor(Math.random()*TITLES.length)]; }

    // ===== DOM =====
    const loading = document.getElementById("loading");
    const loadingCount = document.getElementById("loadingCount");
    const loadingTitle = document.getElementById("loadingTitle");
    const heroTitle = document.getElementById("heroTitle");

    const todayText = document.getElementById("todayText");
    const remainingText = document.getElementById("remainingText");
    const remainingText2 = document.getElementById("remainingText2");
    const streakText = document.getElementById("streakText");
    const pctText = document.getElementById("pctText");
    const barFill = document.getElementById("barFill");

    const clickerWrap = document.getElementById("clickerWrap");
    const clickBtn = document.getElementById("clickBtn");
    const undoBtn = document.getElementById("undoBtn");

    const toast = document.getElementById("toast");
    const confetti = document.getElementById("confetti");

    const stateTitle = document.getElementById("stateTitle");
    const stateCopy = document.getElementById("stateCopy");

    const avatarBlock = document.getElementById("avatarBlock");
    const avatarImg = document.getElementById("avatarImg");
    const streakCounter = document.getElementById("streakCounter");
    const streakMini = document.getElementById("streakMini");
    const streakNow = document.getElementById("streakNow");
    const streakCap = document.getElementById("streakCap");
    const streakFill = document.getElementById("streakFill");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    // ===== State =====
    let state = loadState();
    let currentMonth = new Date(); currentMonth.setDate(1);

    // ===== UI feedback =====
    function pop(el){
      el.classList.remove("pop");
      void el.offsetWidth;
      el.classList.add("pop");
    }

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 700);
    }

    function rippleAt(x, y){
      const r = document.createElement("span");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top = y + "px";
      clickerWrap.appendChild(r);
      setTimeout(()=> r.remove(), 600);
    }

    function burstConfetti(){
      confetti.innerHTML = "";
      confetti.classList.add("show");
      const colors = ["#e33b2f","#ff7a2f","#f4f1e9","#ffb27a"];
      const count = 24;
      for(let i=0;i<count;i++){
        const piece = document.createElement("i");
        piece.style.background = colors[Math.floor(Math.random()*colors.length)];
        piece.style.left = Math.round(Math.random()*100) + "vw";
        piece.style.animationDelay = (Math.random()*0.08) + "s";
        piece.style.opacity = (0.6 + Math.random()*0.4).toFixed(2);
        confetti.appendChild(piece);
      }
      setTimeout(()=> confetti.classList.remove("show"), 950);
    }

    // ===== Core actions =====
    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);

      const prev = day.total;
      const add = Math.floor(n);

      day.total += add;
      day.entries.push({ ts: Date.now(), n: add });

      saveState();
      renderAll();

      pop(todayText);
      showToast(`+${add} added`);

      if(prev < GOAL && day.total >= GOAL){
        burstConfetti();
      }
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = state.days[iso];
      if(!day || !Array.isArray(day.entries) || day.entries.length === 0){
        showToast("Nothing to undo");
        return;
      }

      const last = day.entries.pop();
      const dec = last?.n ?? 0;

      day.total = Math.max(0, (day.total || 0) - dec);

      if(day.total === 0 && day.entries.length === 0){
        delete state.days[iso];
      }

      saveState();
      renderAll();
      pop(todayText);
      showToast(`Undid +${dec}`);
    }

    // ===== Copy states (5 steps) =====
    function renderStateCopy(todayTotal){
      if(todayTotal >= GOAL){
        stateTitle.textContent = "DONE FOR TODAY";
        stateCopy.textContent = "Goal smashed. You’re a machine.";
        return;
      }
      stateTitle.textContent = "KEEP GOING";
      if(todayTotal <= 9) stateCopy.textContent = "You can do it. Start with 10.";
      else if(todayTotal <= 29) stateCopy.textContent = "Nice start — keep the rhythm.";
      else if(todayTotal <= 59) stateCopy.textContent = "Halfway vibes. Don’t give up.";
      else if(todayTotal <= 99) stateCopy.textContent = "Almost there. Finish strong.";
      else stateCopy.textContent = "Goal smashed. You’re a machine.";
    }

    // ===== Render =====
    function renderTop(){
      const iso = toISODateLocal(new Date());
      const todayTotal = getDayTotal(iso);
      const remaining = Math.max(0, GOAL - todayTotal);
      const pct = Math.max(0, Math.min(100, Math.round((todayTotal / GOAL) * 100)));

      todayText.textContent = `TODAY: ${todayTotal} / ${GOAL}`;
      remainingText.textContent = remaining;
      remainingText2.textContent = remaining;
      pctText.textContent = `${pct}%`;
      barFill.style.width = `${pct}%`;

      const streak = calcStreak();
      streakText.textContent = streak;

      renderStateCopy(todayTotal);

      // Avatar as streak power
      const lvl = levelFromStreak(streak);
      avatarImg.src = AVATARS[lvl] || AVATARS[0];

      const glowByLevel = [0.06, 0.12, 0.20, 0.32, 0.45, 0.60];
      avatarBlock.style.setProperty("--pGlow", String(glowByLevel[lvl] ?? 0.08));

      streakCounter.textContent = `STREAK: ${streak} DAYS`;
      if(todayTotal >= GOAL){
        streakMini.textContent = "Locked in. Your streak stays strong.";
      } else {
        streakMini.textContent = "Complete 100 today to keep your power.";
      }

      const cap = nextStreakCap(streak);
      streakNow.textContent = streak;
      streakCap.textContent = cap;
      const prog = cap === 0 ? 0 : Math.min(1, streak / cap);
      streakFill.style.width = `${Math.round(prog * 100)}%`;
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthName(m)} ${y}`;
      calGrid.innerHTML = "";

      const dows = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const keys = Object.keys(state.days).sort();
      const firstLogged = keys[0] || null;

      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7; // Monday=0
      const daysInMonth = new Date(y, m + 1, 0).getDate();
      const todayIso = toISODateLocal(new Date());

      // blanks
      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"></div><div class="dayval"></div>`;
        calGrid.appendChild(ghost);
      }

      // streak chain for glow strip
      const streakChain = new Set();
      {
        const d = new Date();
        while(true){
          const iso = toISODateLocal(d);
          if(getDayTotal(iso) >= GOAL){
            streakChain.add(iso);
            d.setDate(d.getDate()-1);
          } else break;
        }
      }

      for(let dayNum=1; dayNum<=daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);

        let cls = "day";
        if(!firstLogged || iso < firstLogged){
          cls += " before";
        } else {
          if(total >= GOAL) cls += " done";
          else if(total > 0) cls += " started";
          else cls += " missed";
        }

        if(iso === todayIso) cls += " today";
        if(streakChain.has(iso)) cls += " streak";

        const cell = document.createElement("div");
        cell.className = cls;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval">${total ? total : ""}</div>
        `;
        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderTop();
      renderCalendar();
    }

    // ===== Events =====
    clickBtn.addEventListener("click", (e)=>{
      const rect = clickerWrap.getBoundingClientRect();
      rippleAt(e.clientX - rect.left, e.clientY - rect.top);
      addReps(1);
    });

    document.querySelectorAll("[data-add]").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        const rect = clickerWrap.getBoundingClientRect();
        rippleAt(e.clientX - rect.left, e.clientY - rect.top);
        const n = Number(btn.getAttribute("data-add"));
        addReps(n);
      });
    });

    undoBtn.addEventListener("click", undoLast);

    prevMonthBtn.addEventListener("click", ()=>{
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", ()=>{
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", ()=>{
      currentMonth = new Date();
      currentMonth.setDate(1);
      renderAll();
    });

    // ===== Init titles =====
    const t = pickTitle();
    loadingTitle.textContent = t;
    heroTitle.textContent = t;

    renderAll();

    // ===== Loading animation =====
    function runLoading(){
      const durationMs = 820;
      const start = performance.now();
      function tick(now){
        const t = Math.min(1, (now - start) / durationMs);
        const eased = 1 - Math.pow(1 - t, 3);
        loadingCount.textContent = Math.round(eased * 100);
        if(t < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
      setTimeout(() => loading.classList.add("hidden"), 1050);
    }
    window.addEventListener("load", runLoading);
  </script>
</body>
</html>



