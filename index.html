<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 Pushups</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#14161d;
      --text:#e8e8ea;
      --muted:#a8abb6;
      --border:#2a2d38;

      --green:#1f8a4c;
      --orange:#c77d1a;
      --red:#a13232;
      --gray:#3a3f52;

      --btn:#1a1e2a;
      --btn2:#0f1118;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.35;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 22px;
      display: grid;
      gap: 12px;
    }

    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
    }

    /* Big header */
    h1{
      margin: 0;
      font-size: 22px;
      font-weight: 950;
      letter-spacing: 0.9px;
      text-transform: uppercase;
    }
    .sub{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
    }

    h2{
      margin: 0 0 10px 0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing: 0.2px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    input, button{
      font: inherit;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--btn2);
      color: var(--text);
      outline: none;
    }
    input{ width: 100%; }

    button{
      cursor: pointer;
      background: var(--btn);
      touch-action: manipulation;
      font-weight: 850;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    button.ghost{ background: transparent; }
    button.danger{ background: #2a1212; border-color:#4a1b1b; }
    button.good{ background: #102316; border-color:#234b33; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.1fr 1fr; }
      input{ width: 200px; }
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #0f1118;
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
    }

    .mono{
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--gray);
      display:inline-block;
      flex: 0 0 auto;
    }
    .dot.green{ background: var(--green); }
    .dot.orange{ background: var(--orange); }
    .dot.red{ background: var(--red); }
    .dot.gray{ background: var(--gray); }

    /* Make "Gjort idag" BIGGER */
    .big{
      font-size: 60px;
      font-weight: 1000;
      letter-spacing: 0.5px;
      line-height: 1;
    }
    @media (min-width: 860px){
      .big{ font-size: 72px; }
    }
    .bigsub{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
    }

    /* Quick buttons */
    .quick{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .quick button{
      padding: 14px 10px;
      border-radius: 16px;
      font-weight: 1000;
    }

    /* Log list */
    .loglist{
      margin-top: 12px;
      display:flex;
      flex-direction: column;
      gap:8px;
      max-height: 260px;
      overflow:auto;
      padding-right: 4px;
    }
    .logitem{
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
      background: #0f1118;
      display:flex;
      justify-content: space-between;
      gap:10px;
      align-items:center;
    }

    .divider{
      height:1px;
      background: var(--border);
      margin: 12px 0;
    }

    .two{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 860px){
      .two{ grid-template-columns: 1fr 1fr; }
    }

    /* Calendar */
    .cal-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .cal-title{
      font-weight:1000;
      letter-spacing:0.2px;
      font-size: 15px;
    }

    /* FIX: kalendern p√• iPhone ‚Äî mindre gap + stabil cell-h√∂jd */
    .cal{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px; /* mindre √§n innan */
    }
    .dow{
      font-size: 11px;
      color: var(--muted);
      text-align:center;
      padding: 4px 0 6px;
    }

    .day{
      height: clamp(44px, 9.8vw, 62px);
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #0f1118;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 7px 7px 6px;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      min-width: 0;
    }
    .day:hover{ filter: brightness(1.08); }
    .day.off{
      opacity: 0.35;
      cursor: default;
    }
    .daynum{
      font-weight:1000;
      font-size: 13px;
      color: var(--text);
      line-height: 1;
    }
    .dayval{
      font-size: 12px;
      color: var(--muted);
      text-align:right;
      line-height: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .day.gray{ border-color: rgba(58,63,82,0.95); }
    .day.red{ border-color: rgba(161,50,50,0.70); }
    .day.orange{ border-color: rgba(199,125,26,0.80); }
    .day.green{ border-color: rgba(31,138,76,0.80); }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY</h1>
      <div class="sub">Logga flera g√•nger per dag. M√•l: <span class="mono">100</span>.</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Idag</h2>

        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <div class="big mono" id="todayTotal">0</div>
            <div class="bigsub">Gjort idag</div>
          </div>

          <div style="text-align:right;">
            <div class="pill"><span id="statusDot" class="dot"></span><span id="statusText">‚Äî</span></div>
            <div style="height:8px;"></div>
            <div class="pill">Kvar: <span class="mono" id="todayLeft">100</span></div>
          </div>
        </div>

        <div class="quick" aria-label="Snabbknappar">
          <button data-add="5">+5</button>
          <button data-add="10">+10</button>
          <button data-add="15">+15</button>
          <button data-add="20">+20</button>
          <button data-add="25">+25</button>
        </div>

        <div class="row" style="margin-top: 12px;">
          <input id="addInput" type="number" inputmode="numeric" min="1" placeholder="Eget antal (t.ex. 12)" />
          <button id="addBtn" class="good" style="width:100%;">L√§gg till</button>
        </div>

        <div class="two" style="margin-top:10px;">
          <button id="undoBtn" class="ghost" style="width:100%;">√Öngra senaste</button>
          <button id="resetTodayBtn" class="danger" style="width:100%;">Nollst√§ll idag</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <span class="pill">Streak (gr√∂n i rad): <span class="mono" id="streak">0</span></span>
          <span class="pill">30 dagar: <span class="mono" id="statsText">‚Äî</span></span>
        </div>

        <div class="loglist" id="logList"></div>
      </div>

      <div class="card">
        <div class="cal-head">
          <div class="cal-title" id="calTitle">‚Äî</div>
          <div class="row" style="gap:8px;">
            <button id="prevMonthBtn" class="ghost" aria-label="F√∂reg√•ende m√•nad">‚óÄ</button>
            <button id="todayBtn" class="ghost">Idag</button>
            <button id="nextMonthBtn" class="ghost" aria-label="N√§sta m√•nad">‚ñ∂</button>
          </div>
        </div>

        <div class="cal" id="calGrid"></div>

        <div class="legend">
          <span class="pill"><span class="dot green"></span>Gr√∂n = klarat</span>
          <span class="pill"><span class="dot orange"></span>Orange = p√•b√∂rjat</span>
          <span class="pill"><span class="dot red"></span>R√∂d = missad (0 efter start)</span>
          <span class="pill"><span class="dot gray"></span>Gr√• = innan du b√∂rjade</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const GOAL = 100;

    // Helpers
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => {
      const y = d.getFullYear();
      const m = pad2(d.getMonth() + 1);
      const day = pad2(d.getDate());
      return `${y}-${m}-${day}`;
    };
    const monthNameSV = (m) => [
      "Januari","Februari","Mars","April","Maj","Juni",
      "Juli","Augusti","September","Oktober","November","December"
    ][m];

    // Storage (same key as your current version)
    const STORAGE_KEY = "pushups_simple_v2";

    function defaultState(){ return { days: {} }; }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return defaultState();
        if(!parsed.days || typeof parsed.days !== "object") parsed.days = {};
        for(const k of Object.keys(parsed.days)){
          const day = parsed.days[k];
          if(!day || typeof day !== "object") { delete parsed.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return parsed;
      }catch{
        return defaultState();
      }
    }
    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function ensureDay(iso){
      if(!state.days[iso]) state.days[iso] = { total: 0, entries: [] };
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    let state = loadState();
    let currentMonth = new Date();
    currentMonth.setDate(1);

    // DOM
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const todayTotalEl = document.getElementById("todayTotal");
    const todayLeftEl = document.getElementById("todayLeft");

    const addInput = document.getElementById("addInput");
    const addBtn = document.getElementById("addBtn");
    const undoBtn = document.getElementById("undoBtn");
    const resetTodayBtn = document.getElementById("resetTodayBtn");

    const streakEl = document.getElementById("streak");
    const statsTextEl = document.getElementById("statsText");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    const logList = document.getElementById("logList");

    function getFirstLoggedISO(){
      const keys = Object.keys(state.days);
      if(keys.length === 0) return null;
      keys.sort(); // YYYY-MM-DD sorts correctly
      return keys[0];
    }

    function getDayTotal(iso){
      return state.days[iso]?.total ?? 0;
    }

    // Gray before start, red only after start date
    function getDayStatus(iso, total, firstISO){
      if(!firstISO) return "gray";        // no logging ever yet
      if(iso < firstISO) return "gray";   // before you started
      if(total >= GOAL) return "green";
      if(total > 0) return "orange";
      return "red";                       // after start, 0 = missed
    }

    function calcStreak(){
      let streak = 0;
      let d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        if(getDayTotal(iso) >= GOAL){
          streak += 1;
          d.setDate(d.getDate() - 1);
        }else break;
      }
      return streak;
    }

    function calc30DayStats(){
      const today = new Date();
      const firstISO = getFirstLoggedISO();
      let green=0, orange=0, red=0, gray=0, sum=0;

      for(let i=0;i<30;i++){
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatus(iso, total, firstISO);

        if(st === "gray"){ gray++; continue; }
        sum += total;
        if(st === "green") green++;
        else if(st === "orange") orange++;
        else red++;
      }
      return { green, orange, red, gray, sum };
    }

    function renderToday(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const total = day.total;

      todayTotalEl.textContent = total;
      todayLeftEl.textContent = Math.max(0, GOAL - total);

      const firstISO = getFirstLoggedISO();
      const st = getDayStatus(iso, total, firstISO);

      statusDot.className = "dot " + st;
      statusText.textContent =
        st === "green" ? "Klar ‚úÖ" :
        st === "orange" ? "P√•b√∂rjad" :
        st === "red" ? "Missad (0)" :
        "Inte b√∂rjat √§n";

      streakEl.textContent = calcStreak();
      const s = calc30DayStats();
      statsTextEl.textContent = `üü© ${s.green}  üüß ${s.orange}  üü• ${s.red}  ü©∂ ${s.gray}  ‚Ä¢  Totalt: ${s.sum}`;

      logList.innerHTML = "";
      const entries = day.entries.slice().sort((a,b) => b.ts - a.ts);
      if(entries.length === 0){
        const empty = document.createElement("div");
        empty.style.color = "var(--muted)";
        empty.style.fontSize = "13px";
        empty.textContent = "Inga inl√§gg idag √§nnu.";
        logList.appendChild(empty);
      }else{
        for(const e of entries){
          const item = document.createElement("div");
          item.className = "logitem";
          const t = new Date(e.ts);
          const hh = pad2(t.getHours());
          const mm = pad2(t.getMinutes());
          item.innerHTML = `
            <div>
              <div class="mono">${e.n} st</div>
              <div style="color:var(--muted); font-size:13px;">${hh}:${mm}</div>
            </div>
            <div style="color:var(--muted); font-size:13px;">+${e.n}</div>
          `;
          logList.appendChild(item);
        }
      }
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthNameSV(m)} ${y}`;
      calGrid.innerHTML = "";

      const dows = ["M√•n","Tis","Ons","Tor","Fre","L√∂r","S√∂n"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const firstISO = getFirstLoggedISO();

      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7;
      const daysInMonth = new Date(y, m + 1, 0).getDate();

      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"></div><div class="dayval"></div>`;
        calGrid.appendChild(ghost);
      }

      for(let dayNum = 1; dayNum <= daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatus(iso, total, firstISO);

        const cell = document.createElement("div");
        cell.className = `day ${st}`;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval mono">${total ? total : ""}</div>
        `;

        cell.addEventListener("click", () => {
          const label =
            st === "gray" ? "Innan du b√∂rjade" :
            st === "red" ? "Missad (0)" :
            st === "orange" ? "P√•b√∂rjad" : "Klar";

          const msg =
            `${iso}\nStatus: ${label}\nTotalt: ${total}\n\nOK = nollst√§ll den h√§r dagen\nAvbryt = l√§mna som det √§r`;

          if(confirm(msg)){
            delete state.days[iso];
            saveState();
            renderAll();
          }
        });

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderToday();
      renderCalendar();
    }

    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const add = Math.floor(n);
      day.total += add;
      day.entries.push({ ts: Date.now(), n: add });
      saveState();
      renderAll();
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;
      const last = day.entries.pop();
      day.total = Math.max(0, day.total - (last?.n ?? 0));
      if(day.total === 0 && day.entries.length === 0) delete state.days[iso];
      saveState();
      renderAll();
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      delete state.days[iso];
      saveState();
      renderAll();
    }

    // Wire up
    document.querySelectorAll("button[data-add]").forEach(btn => {
      btn.addEventListener("click", () => addReps(Number(btn.dataset.add)));
    });

    addBtn.addEventListener("click", () => {
      const n = Number(addInput.value);
      addInput.value = "";
      addInput.focus();
      addReps(n);
    });
    addInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") addBtn.click();
    });

    undoBtn.addEventListener("click", undoLast);
    resetTodayBtn.addEventListener("click", () => {
      if(confirm("Nollst√§lla dagens logg?")) resetToday();
    });

    prevMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      currentMonth = new Date();
      currentMonth.setDate(1);
      renderAll();
    });

    renderAll();
  </script>
</body>
</html>
