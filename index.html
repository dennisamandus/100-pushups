<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>100 Pushups</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#14161d;
      --text:#e8e8ea;
      --muted:#a8abb6;
      --border:#2a2d38;

      --green:#1f8a4c;
      --orange:#c77d1a;
      --red:#a13232;
      --gray:#3a3f52;

      --btn:#1a1e2a;
      --btn2:#0f1118;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header */
    .top{
      padding: 14px 14px 10px;
      max-width: 980px;
      margin: 0 auto;
    }
    .title{
      font-weight: 1000;
      letter-spacing: 0.9px;
      text-transform: uppercase;
      font-size: 20px;
      line-height: 1.15;
    }
    .subtitle{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
    }

    /* Main layout */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 14px 18px;
      display: grid;
      gap: 12px;
    }

    /* Tap area (like simplecounter) */
    .tapArea{
      position: relative;
      overflow: hidden;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: radial-gradient(1200px 600px at 50% 0%, rgba(255,255,255,0.06), transparent 60%),
                  var(--panel);
      padding: 18px 14px 14px;
      min-height: 250px;
      display: grid;
      align-content: center;
      justify-items: center;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .big{
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: clamp(64px, 15vw, 110px);
      font-weight: 1000;
      letter-spacing: 0.5px;
      line-height: 1;
      text-align:center;
    }
    .bigLabel{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      text-align:center;
    }

    .statusRow{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15,17,24,0.7);
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--gray);
      display:inline-block;
      flex: 0 0 auto;
    }
    .dot.green{ background: var(--green); }
    .dot.orange{ background: var(--orange); }
    .dot.red{ background: var(--red); }
    .dot.gray{ background: var(--gray); }

    /* Controls */
    .controls{
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--panel);
      padding: 12px;
      display:grid;
      gap: 10px;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content: space-between;
    }
    button, input{
      font: inherit;
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 12px;
      background: var(--btn2);
      color: var(--text);
      outline: none;
    }
    button{
      cursor:pointer;
      background: var(--btn);
      font-weight: 900;
      touch-action: manipulation;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    button.ghost{ background: transparent; }
    button.danger{ background:#2a1212; border-color:#4a1b1b; }
    button.good{ background:#102316; border-color:#234b33; }

    .stepGrid{
      display:grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 8px;
    }
    .stepBtn{
      padding: 12px 8px;
      border-radius: 16px;
      font-weight: 1000;
      background: transparent;
    }
    .stepBtn.active{
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.15);
    }

    .manualRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 860px){
      .wrap{ grid-template-columns: 1.05fr 1fr; align-items:start; }
      .manualRow{ grid-template-columns: 1fr auto; }
      input{ width: 220px; }
    }
    input{ width: 100%; background: var(--btn2); }

    /* Ripple */
    .ripple{
      position:absolute;
      border-radius: 999px;
      transform: translate(-50%,-50%);
      pointer-events:none;
      background: rgba(255,255,255,0.10);
      animation: ripple 520ms ease-out forwards;
      mix-blend-mode: screen;
    }
    @keyframes ripple{
      from{ width: 0; height: 0; opacity: 0.55; }
      to{ width: 520px; height: 520px; opacity: 0; }
    }

    /* Calendar */
    .calCard{
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--panel);
      padding: 12px;
    }
    .calHead{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }
    .calTitle{
      font-weight: 1000;
      letter-spacing: 0.2px;
      font-size: 15px;
    }
    .calBtns{ display:flex; gap:8px; }
    .cal{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
    }
    .dow{
      font-size: 11px;
      color: var(--muted);
      text-align:center;
      padding: 4px 0 6px;
    }
    .day{
      height: clamp(44px, 9.8vw, 62px);
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #0f1118;
      padding: 7px 7px 6px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      min-width:0;
    }
    .day.off{ opacity:0.35; cursor:default; }
    .daynum{ font-weight:1000; font-size: 13px; line-height:1; }
    .dayval{
      font-size: 12px;
      color: var(--muted);
      text-align:right;
      line-height:1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    .day.gray{ border-color: rgba(58,63,82,0.95); }
    .day.red{ border-color: rgba(161,50,50,0.70); }
    .day.orange{ border-color: rgba(199,125,26,0.80); }
    .day.green{ border-color: rgba(31,138,76,0.80); }

    .legend{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap: wrap;
    }

    /* Tiny footer text */
    .tiny{
      color: var(--muted);
      font-size: 12px;
      text-align:center;
      padding: 8px 0 0;
    }
  </style>
</head>
<body>
  <div class="top">
    <div class="title">100 PUSHUPS A-DAY KEEP DA DOCTOR A-WAY</div>
    <div class="subtitle">Tryck p√• ytan f√∂r att logga. M√•l: <b>100</b>/dag.</div>
  </div>

  <div class="wrap">
    <!-- Tap counter -->
    <div>
      <div class="tapArea" id="tapArea" aria-label="Tryck f√∂r att logga">
        <div class="big" id="todayTotal">0</div>
        <div class="bigLabel">GJORT IDAG</div>

        <div class="statusRow">
          <span class="pill"><span id="statusDot" class="dot"></span><span id="statusText">‚Äî</span></span>
          <span class="pill">Kvar: <span id="todayLeft">100</span></span>
          <span class="pill">Step: <span id="stepText">10</span></span>
        </div>
      </div>

      <div class="controls" style="margin-top:12px;">
        <div class="row">
          <div class="pill">Streak: <span id="streak">0</span></div>
          <div class="pill">30 dagar: <span id="statsText">‚Äî</span></div>
        </div>

        <div>
          <div style="color:var(--muted); font-size:12px; margin: 0 0 8px 2px;">V√§lj hur mycket varje tryck ska logga:</div>
          <div class="stepGrid" id="stepGrid">
            <button class="stepBtn" data-step="1">1</button>
            <button class="stepBtn" data-step="5">5</button>
            <button class="stepBtn" data-step="10">10</button>
            <button class="stepBtn" data-step="15">15</button>
            <button class="stepBtn" data-step="20">20</button>
            <button class="stepBtn" data-step="25">25</button>
          </div>
        </div>

        <div class="manualRow">
          <input id="addInput" type="number" inputmode="numeric" min="1" placeholder="Eget antal (t.ex. 12)" />
          <button id="addBtn" class="good">L√§gg till</button>
        </div>

        <div class="row">
          <button id="undoBtn" class="ghost" style="flex:1;">√Öngra senaste</button>
          <button id="resetTodayBtn" class="danger" style="flex:1;">Nollst√§ll idag</button>
        </div>

        <div class="tiny">Tips: Du kan bara trycka p√• stora ytan mellan set ‚Äì ingen precisionsklick beh√∂vs.</div>
      </div>
    </div>

    <!-- Calendar -->
    <div class="calCard">
      <div class="calHead">
        <div class="calTitle" id="calTitle">‚Äî</div>
        <div class="calBtns">
          <button id="prevMonthBtn" class="ghost" aria-label="F√∂reg√•ende m√•nad">‚óÄ</button>
          <button id="todayBtn" class="ghost">Idag</button>
          <button id="nextMonthBtn" class="ghost" aria-label="N√§sta m√•nad">‚ñ∂</button>
        </div>
      </div>

      <div class="cal" id="calGrid"></div>

      <div class="legend">
        <span class="pill"><span class="dot green"></span>Gr√∂n = klarat</span>
        <span class="pill"><span class="dot orange"></span>Orange = p√•b√∂rjat</span>
        <span class="pill"><span class="dot red"></span>R√∂d = missad (0 efter start)</span>
        <span class="pill"><span class="dot gray"></span>Gr√• = innan du b√∂rjade</span>
      </div>
    </div>
  </div>

  <script>
    const GOAL = 100;

    // Keep your current device data (same key as your latest versions)
    const STORAGE_KEY = "pushups_simple_v2";

    // Helpers
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    const monthNameSV = (m) => ["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][m];

    function defaultState(){
      return { days: {}, step: 10 };
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return defaultState();
        if(!parsed.days || typeof parsed.days !== "object") parsed.days = {};
        if(typeof parsed.step !== "number" || parsed.step <= 0) parsed.step = 10;
        for(const k of Object.keys(parsed.days)){
          const day = parsed.days[k];
          if(!day || typeof day !== "object") { delete parsed.days[k]; continue; }
          if(typeof day.total !== "number") day.total = 0;
          if(!Array.isArray(day.entries)) day.entries = [];
        }
        return parsed;
      }catch{
        return defaultState();
      }
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function ensureDay(iso){
      if(!state.days[iso]) state.days[iso] = { total: 0, entries: [] };
      const d = state.days[iso];
      if(typeof d.total !== "number") d.total = 0;
      if(!Array.isArray(d.entries)) d.entries = [];
      return d;
    }

    let state = loadState();
    let currentMonth = new Date(); currentMonth.setDate(1);

    // DOM
    const tapArea = document.getElementById("tapArea");
    const todayTotalEl = document.getElementById("todayTotal");
    const todayLeftEl = document.getElementById("todayLeft");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const streakEl = document.getElementById("streak");
    const statsTextEl = document.getElementById("statsText");
    const stepText = document.getElementById("stepText");

    const stepGrid = document.getElementById("stepGrid");
    const addInput = document.getElementById("addInput");
    const addBtn = document.getElementById("addBtn");
    const undoBtn = document.getElementById("undoBtn");
    const resetTodayBtn = document.getElementById("resetTodayBtn");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    function getFirstLoggedISO(){
      const keys = Object.keys(state.days);
      if(keys.length === 0) return null;
      keys.sort();
      return keys[0];
    }

    function getDayTotal(iso){ return state.days[iso]?.total ?? 0; }

    function getDayStatus(iso, total, firstISO){
      if(!firstISO) return "gray";
      if(iso < firstISO) return "gray";
      if(total >= GOAL) return "green";
      if(total > 0) return "orange";
      return "red";
    }

    function calcStreak(){
      let streak = 0;
      const d = new Date();
      while(true){
        const iso = toISODateLocal(d);
        if(getDayTotal(iso) >= GOAL){
          streak++;
          d.setDate(d.getDate()-1);
        }else break;
      }
      return streak;
    }

    function calc30DayStats(){
      const today = new Date();
      const firstISO = getFirstLoggedISO();
      let green=0, orange=0, red=0, gray=0, sum=0;

      for(let i=0;i<30;i++){
        const d = new Date(today);
        d.setDate(today.getDate()-i);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatus(iso, total, firstISO);
        if(st === "gray"){ gray++; continue; }
        sum += total;
        if(st === "green") green++;
        else if(st === "orange") orange++;
        else red++;
      }
      return { green, orange, red, gray, sum };
    }

    function setStep(n){
      state.step = n;
      saveState();
      renderStepUI();
    }

    function renderStepUI(){
      stepText.textContent = state.step;
      stepGrid.querySelectorAll("button").forEach(b => {
        b.classList.toggle("active", Number(b.dataset.step) === state.step);
      });
    }

    function rippleAt(x, y){
      const r = document.createElement("span");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top = y + "px";
      tapArea.appendChild(r);
      setTimeout(() => r.remove(), 600);
    }

    function maybeVibrate(){
      try{
        if(navigator.vibrate) navigator.vibrate(10);
      }catch{}
    }

    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const add = Math.floor(n);
      day.total += add;
      day.entries.push({ ts: Date.now(), n: add });
      saveState();
      renderAll();
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;
      const last = day.entries.pop();
      day.total = Math.max(0, day.total - (last?.n ?? 0));
      if(day.total === 0 && day.entries.length === 0) delete state.days[iso];
      saveState();
      renderAll();
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      delete state.days[iso];
      saveState();
      renderAll();
    }

    function renderToday(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const total = day.total;

      todayTotalEl.textContent = total;
      todayLeftEl.textContent = Math.max(0, GOAL - total);

      const firstISO = getFirstLoggedISO();
      const st = getDayStatus(iso, total, firstISO);
      statusDot.className = "dot " + st;
      statusText.textContent =
        st === "green" ? "Klar ‚úÖ" :
        st === "orange" ? "P√•b√∂rjad" :
        st === "red" ? "Missad (0)" :
        "Inte b√∂rjat √§n";

      streakEl.textContent = calcStreak();

      const s = calc30DayStats();
      statsTextEl.textContent = `üü© ${s.green}  üüß ${s.orange}  üü• ${s.red}  ü©∂ ${s.gray}  ‚Ä¢  Totalt: ${s.sum}`;
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthNameSV(m)} ${y}`;
      calGrid.innerHTML = "";

      const dows = ["M√•n","Tis","Ons","Tor","Fre","L√∂r","S√∂n"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      const firstISO = getFirstLoggedISO();
      const first = new Date(y, m, 1);
      const firstDow = (first.getDay() + 6) % 7;
      const daysInMonth = new Date(y, m + 1, 0).getDate();

      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"></div><div class="dayval"></div>`;
        calGrid.appendChild(ghost);
      }

      for(let dayNum=1; dayNum<=daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const total = getDayTotal(iso);
        const st = getDayStatus(iso, total, firstISO);

        const cell = document.createElement("div");
        cell.className = `day ${st}`;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval">${total ? total : ""}</div>
        `;

        cell.addEventListener("click", () => {
          const label =
            st === "gray" ? "Innan du b√∂rjade" :
            st === "red" ? "Missad (0)" :
            st === "orange" ? "P√•b√∂rjad" : "Klar";

          const msg =
            `${iso}\nStatus: ${label}\nTotalt: ${total}\n\nOK = nollst√§ll den h√§r dagen\nAvbryt = l√§mna som det √§r`;

          if(confirm(msg)){
            delete state.days[iso];
            saveState();
            renderAll();
          }
        });

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderStepUI();
      renderToday();
      renderCalendar();
    }

    // Events
    tapArea.addEventListener("pointerdown", (e) => {
      // ignore if user is selecting text etc.
      const rect = tapArea.getBoundingClientRect();
      rippleAt(e.clientX - rect.left, e.clientY - rect.top);
      maybeVibrate();
      addReps(state.step);
    });

    stepGrid.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-step]");
      if(!btn) return;
      setStep(Number(btn.dataset.step));
    });

    addBtn.addEventListener("click", () => {
      const n = Number(addInput.value);
      addInput.value = "";
      addInput.focus();
      addReps(n);
    });
    addInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") addBtn.click();
    });

    undoBtn.addEventListener("click", undoLast);
    resetTodayBtn.addEventListener("click", () => {
      if(confirm("Nollst√§lla dagens logg?")) resetToday();
    });

    prevMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      currentMonth = new Date(); currentMonth.setDate(1);
      renderAll();
    });

    renderAll();
  </script>
</body>
</html>
