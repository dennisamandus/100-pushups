<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>100 armhävningar / dag</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#14161d;
      --text:#e8e8ea;
      --muted:#a8abb6;
      --border:#2a2d38;

      --green:#1f8a4c;
      --orange:#c77d1a;
      --red:#a13232;
      --gray:#3a3f52;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px;
      display: grid;
      gap: 14px;
    }
    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
    }
    h1,h2{
      margin: 0 0 10px 0;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    h1{ font-size: 18px; }
    h2{ font-size: 16px; color: var(--text); }
    .muted{ color: var(--muted); font-size: 13px; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items: center;
    }
    input, button{
      font: inherit;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0f1118;
      color: var(--text);
      outline: none;
    }
    input{ width: 120px; }
    button{
      cursor: pointer;
      background: #1a1e2a;
    }
    button:hover{ filter: brightness(1.08); }
    button.danger{ background: #2a1212; border-color:#4a1b1b; }
    button.ghost{ background: transparent; }

    .big{
      font-size: 28px;
      font-weight: 800;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #0f1118;
      font-size: 13px;
      color: var(--muted);
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--gray);
      display:inline-block;
    }
    .dot.green{ background: var(--green); }
    .dot.orange{ background: var(--orange); }
    .dot.red{ background: var(--red); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 860px){
      .grid2{ grid-template-columns: 1.1fr 1fr; }
    }

    /* Kalender */
    .cal-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .cal-title{
      font-weight:700;
      letter-spacing:0.2px;
    }
    .cal{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    .dow{
      font-size: 12px;
      color: var(--muted);
      text-align:center;
      padding: 6px 0;
    }
    .day{
      aspect-ratio: 1 / 1;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0f1118;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 8px;
      cursor:pointer;
      user-select:none;
    }
    .day:hover{ filter: brightness(1.08); }
    .day.off{
      opacity: 0.35;
      cursor: default;
    }
    .daynum{
      font-weight:700;
      font-size: 13px;
      color: var(--text);
    }
    .dayval{
      font-size: 12px;
      color: var(--muted);
      text-align:right;
    }
    .day.red{ border-color: rgba(161,50,50,0.65); }
    .day.orange{ border-color: rgba(199,125,26,0.75); }
    .day.green{ border-color: rgba(31,138,76,0.75); }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    /* Lista */
    .loglist{
      margin-top: 10px;
      display:flex;
      flex-direction: column;
      gap:8px;
      max-height: 260px;
      overflow:auto;
      padding-right: 4px;
    }
    .logitem{
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: #0f1118;
      display:flex;
      justify-content: space-between;
      gap:10px;
      align-items:center;
    }
    .mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Armhävningar – dagligt mål</h1>
      <div class="muted">Sparas lokalt i din webbläsare. Ingen inloggning. Ingen server.</div>
    </div>

    <div class="grid2">
      <div class="card">
        <h2>Dagens logg</h2>

        <div class="row" style="margin-bottom:10px;">
          <span class="pill"><span id="statusDot" class="dot"></span><span id="statusText">—</span></span>
          <span class="pill">Mål: <span class="mono" id="goalText">100</span>/dag</span>
          <span class="pill">Idag: <span class="mono" id="todayTotal">0</span></span>
          <span class="pill">Kvar: <span class="mono" id="todayLeft">100</span></span>
        </div>

        <div class="row">
          <input id="addInput" type="number" inputmode="numeric" min="1" placeholder="t.ex. 15" />
          <button id="addBtn">Lägg till</button>

          <input id="goalInput" type="number" inputmode="numeric" min="1" placeholder="mål (100)" />
          <button id="setGoalBtn" class="ghost">Sätt mål</button>

          <button id="undoBtn" class="ghost">Ångra senaste</button>
          <button id="resetTodayBtn" class="danger">Nollställ idag</button>
        </div>

        <div class="muted" style="margin-top:10px;">
          Tips: Klicka på en dag i kalendern för att se totalsumma och ev. nollställa just den dagen.
        </div>

        <div class="loglist" id="logList"></div>
      </div>

      <div class="card">
        <div class="cal-head">
          <div class="cal-title" id="calTitle">—</div>
          <div class="row">
            <button id="prevMonthBtn" class="ghost">◀</button>
            <button id="todayBtn" class="ghost">Idag</button>
            <button id="nextMonthBtn" class="ghost">▶</button>
          </div>
        </div>

        <div class="cal" id="calGrid">
          <!-- byggs i JS -->
        </div>

        <div class="legend">
          <span class="pill"><span class="dot green"></span>Grön = klarat</span>
          <span class="pill"><span class="dot orange"></span>Orange = påbörjat</span>
          <span class="pill"><span class="dot red"></span>Röd = inte börjat</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODateLocal = (d) => {
      // Lokal datumsträng YYYY-MM-DD
      const y = d.getFullYear();
      const m = pad2(d.getMonth() + 1);
      const day = pad2(d.getDate());
      return `${y}-${m}-${day}`;
    };
    const monthNameSV = (m) => [
      "Januari","Februari","Mars","April","Maj","Juni",
      "Juli","Augusti","September","Oktober","November","December"
    ][m];

    // ---------- Storage ----------
    // data structure:
    // {
    //   goal: number,
    //   days: {
    //     "YYYY-MM-DD": { total: number, entries: [{ts:number, n:number}] }
    //   }
    // }
    const STORAGE_KEY = "pushups_simple_v1";

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return { goal: 100, days: {} };
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return { goal: 100, days: {} };
        if(typeof parsed.goal !== "number") parsed.goal = 100;
        if(!parsed.days || typeof parsed.days !== "object") parsed.days = {};
        return parsed;
      }catch{
        return { goal: 100, days: {} };
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function ensureDay(iso){
      if(!state.days[iso]){
        state.days[iso] = { total: 0, entries: [] };
      }
      if(typeof state.days[iso].total !== "number") state.days[iso].total = 0;
      if(!Array.isArray(state.days[iso].entries)) state.days[iso].entries = [];
      return state.days[iso];
    }

    // ---------- App State ----------
    let state = loadState();
    let currentMonth = new Date();
    currentMonth.setDate(1);

    // ---------- DOM ----------
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const goalText = document.getElementById("goalText");
    const todayTotalEl = document.getElementById("todayTotal");
    const todayLeftEl = document.getElementById("todayLeft");

    const addInput = document.getElementById("addInput");
    const addBtn = document.getElementById("addBtn");
    const goalInput = document.getElementById("goalInput");
    const setGoalBtn = document.getElementById("setGoalBtn");
    const undoBtn = document.getElementById("undoBtn");
    const resetTodayBtn = document.getElementById("resetTodayBtn");

    const calTitle = document.getElementById("calTitle");
    const calGrid = document.getElementById("calGrid");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const todayBtn = document.getElementById("todayBtn");

    const logList = document.getElementById("logList");

    // ---------- Core logic ----------
    function getDayStatus(total){
      if(total >= state.goal) return "green";
      if(total > 0) return "orange";
      return "red";
    }

    function renderToday(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      const total = day.total;

      goalText.textContent = state.goal;
      todayTotalEl.textContent = total;

      const left = Math.max(0, state.goal - total);
      todayLeftEl.textContent = left;

      const st = getDayStatus(total);
      statusDot.className = "dot " + st;
      statusText.textContent =
        st === "green" ? "Klar ✅" :
        st === "orange" ? "Påbörjad" :
        "Inte börjad";

      // logglista (idag)
      logList.innerHTML = "";
      const entries = day.entries.slice().sort((a,b) => b.ts - a.ts);
      if(entries.length === 0){
        const empty = document.createElement("div");
        empty.className = "muted";
        empty.textContent = "Inga inlägg idag ännu.";
        logList.appendChild(empty);
      }else{
        for(const e of entries){
          const item = document.createElement("div");
          item.className = "logitem";
          const t = new Date(e.ts);
          const hh = pad2(t.getHours());
          const mm = pad2(t.getMinutes());
          item.innerHTML = `
            <div>
              <div class="mono">${e.n} st</div>
              <div class="muted">${hh}:${mm}</div>
            </div>
            <div class="muted">+${e.n}</div>
          `;
          logList.appendChild(item);
        }
      }
    }

    function renderCalendar(){
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      calTitle.textContent = `${monthNameSV(m)} ${y}`;

      calGrid.innerHTML = "";

      // Dagar i veckan header (Mån först)
      const dows = ["Mån","Tis","Ons","Tor","Fre","Lör","Sön"];
      for(const d of dows){
        const el = document.createElement("div");
        el.className = "dow";
        el.textContent = d;
        calGrid.appendChild(el);
      }

      // Första dagen i månaden
      const first = new Date(y, m, 1);
      // JS: 0=Sun...6=Sat, vi vill ha Mån=0 ... Sön=6
      const firstDow = (first.getDay() + 6) % 7;

      const daysInMonth = new Date(y, m + 1, 0).getDate();

      // Fyll "tomma" rutor före 1:a
      for(let i=0;i<firstDow;i++){
        const ghost = document.createElement("div");
        ghost.className = "day off";
        ghost.innerHTML = `<div class="daynum"> </div><div class="dayval"> </div>`;
        calGrid.appendChild(ghost);
      }

      // Månadens dagar
      for(let dayNum = 1; dayNum <= daysInMonth; dayNum++){
        const d = new Date(y, m, dayNum);
        const iso = toISODateLocal(d);
        const dayObj = state.days[iso];
        const total = dayObj?.total ?? 0;
        const st = getDayStatus(total);

        const cell = document.createElement("div");
        cell.className = `day ${st}`;
        cell.innerHTML = `
          <div class="daynum">${dayNum}</div>
          <div class="dayval mono">${total}</div>
        `;

        cell.addEventListener("click", () => {
          const goal = state.goal;
          const msg =
            `${iso}\n` +
            `Totalt: ${total}\n` +
            `Mål: ${goal}\n\n` +
            `OK = nollställ den här dagen\n` +
            `Avbryt = lämna som det är`;
          const ok = confirm(msg);
          if(ok){
            delete state.days[iso];
            saveState();
            renderAll();
          }
        });

        calGrid.appendChild(cell);
      }
    }

    function renderAll(){
      renderToday();
      renderCalendar();
    }

    // ---------- Actions ----------
    function addReps(n){
      if(!Number.isFinite(n) || n <= 0) return;
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      day.total += n;
      day.entries.push({ ts: Date.now(), n });
      saveState();
      renderAll();
    }

    function undoLast(){
      const iso = toISODateLocal(new Date());
      const day = ensureDay(iso);
      if(day.entries.length === 0) return;
      // senaste = max ts (men vi lägger alltid med Date.now, så sista är senaste)
      const last = day.entries.pop();
      day.total = Math.max(0, day.total - (last?.n ?? 0));
      if(day.total === 0 && day.entries.length === 0){
        delete state.days[iso];
      }
      saveState();
      renderAll();
    }

    function resetToday(){
      const iso = toISODateLocal(new Date());
      delete state.days[iso];
      saveState();
      renderAll();
    }

    function setGoal(n){
      if(!Number.isFinite(n) || n <= 0) return;
      state.goal = Math.floor(n);
      saveState();
      renderAll();
    }

    // ---------- Wire up ----------
    addBtn.addEventListener("click", () => {
      const n = Number(addInput.value);
      addInput.value = "";
      addInput.focus();
      addReps(n);
    });
    addInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        addBtn.click();
      }
    });

    setGoalBtn.addEventListener("click", () => {
      const n = Number(goalInput.value);
      goalInput.value = "";
      setGoal(n);
    });

    undoBtn.addEventListener("click", undoLast);

    resetTodayBtn.addEventListener("click", () => {
      const ok = confirm("Nollställa dagens logg?");
      if(ok) resetToday();
    });

    prevMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener("click", () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      currentMonth = new Date();
      currentMonth.setDate(1);
      renderAll();
    });

    // ---------- Init ----------
    renderAll();
  </script>
</body>
</html>
